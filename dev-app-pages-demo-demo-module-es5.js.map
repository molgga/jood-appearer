{"version":3,"sources":["webpack:///projects/dev/src/app/pages/demo/lazy-actor/lazy-actor.component.ts","webpack:///projects/dev/src/app/pages/demo/demo.module.ts","webpack:///projects/dev/src/app/pages/demo/base-actor/base-actor.component.html","webpack:///projects/dev/src/app/pages/demo/demo.routing.ts","webpack:///projects/packages/src/actor/once-actor.ts","webpack:///projects/dev/src/app/pages/demo/lazy-actor/lazy-actor.component.scss","webpack:///projects/dev/src/app/pages/demo/once-actor/once-actor.component.ts","webpack:///projects/packages/src/common/types.ts","webpack:///projects/dev/src/app/pages/demo/base-actor/base-actor.component.ts","webpack:///projects/dev/src/app/modules/example/common/sample-actor/sample-actor.component.ts","webpack:///projects/dev/src/app/pages/demo/base-actor/base-actor.component.scss","webpack:///node_modules/intersection-observer/intersection-observer.js","webpack:///projects/dev/src/app/pages/demo/lazy-actor/lazy-actor.component.html","webpack:///projects/dev/src/app/pages/demo/once-actor/once-actor.component.scss","webpack:///projects/dev/src/app/modules/example/common/sample-actor/types.ts","webpack:///projects/dev/src/app/modules/example/common/sample-actor/sample-actor.component.scss","webpack:///projects/packages/src/actor/base-actor.ts","webpack:///projects/dev/src/app/pages/demo/once-actor/once-actor.component.html","webpack:///projects/packages/src/public-api.ts","webpack:///projects/dev/src/app/modules/example/common/common.module.ts","webpack:///projects/packages/src/actor/lazy-actor.ts","webpack:///projects/packages/src/stage/appear-stage.ts","webpack:///projects/dev/src/app/modules/example/common/sample-actor/sample-actor.component.html"],"names":["LazyActorComponent","actorMakeList","Array","from","map","a","b","id","appearStage","init","evt","type","actor","ATTACH","observe","DETACH","unobserve","dispose","err","console","log","selector","template","PageModule","imports","declarations","routes","path","children","component","RoutingModule","forChild","exports","OnceActor","entry","isAppear","dispatch","APPEAR","stage","OnceActorComponent","AppearType","AppearEvent","option","DISAPPEAR","BaseActorComponent","SampleActorComponent","elRef","emitter","appearCount","disappearCount","appearerListener","nativeElement","actorType","ONCE","LAZY","setCheckoutDelay","setAppearDelay","observeAppearEvent","events","subscribe","onAppearEvent","bind","add","emit","unsubscribe","window","IntersectionObserverEntry","prototype","Object","defineProperty","get","intersectionRatio","getFrameElement","doc","defaultView","frameElement","e","document","startDoc","frame","ownerDocument","registry","crossOriginUpdater","crossOriginRect","time","target","rootBounds","ensureDOMRect","boundingClientRect","intersectionRect","getEmptyRect","isIntersecting","targetRect","targetArea","width","height","intersectionArea","Number","toFixed","IntersectionObserver","callback","opt_options","options","Error","root","nodeType","_checkForIntersections","throttle","THROTTLE_TIMEOUT","_callback","_observationTargets","_queuedEntries","_rootMarginValues","_parseRootMargin","rootMargin","thresholds","_initThresholds","threshold","margin","value","unit","join","_monitoringDocuments","_monitoringUnsubscribes","POLL_INTERVAL","USE_MUTATION_OBSERVER","_setupCrossOriginUpdater","convertFromParentRect","forEach","observer","_resetCrossOriginUpdater","isTargetAlreadyObserved","some","item","element","_registerInstance","push","_monitorIntersections","filter","_unmonitorIntersections","length","_unregisterInstance","disconnect","_unmonitorAllIntersections","takeRecords","records","slice","opt_threshold","isArray","sort","t","i","isNaN","opt_rootMargin","marginString","margins","split","parts","exec","parseFloat","win","indexOf","monitoringInterval","domObserver","setInterval","addEvent","MutationObserver","attributes","childList","characterData","subtree","clearInterval","removeEvent","index","rootDoc","hasDependentTargets","itemDoc","splice","unsubscribes","rootIsInDom","_rootIsInDom","rootRect","_getRootRect","getBoundingClientRect","rootContainsTarget","_rootContainsTarget","oldEntry","_computeTargetAndRootIntersection","newEntry","now","_hasCrossedThreshold","getComputedStyle","display","parent","getParentNode","atRoot","parentRect","parentComputedStyle","frameRect","frameIntersect","body","documentElement","overflow","computeRectIntersection","html","top","left","right","clientWidth","bottom","clientHeight","_expandRectByRootMargin","rect","newRect","oldRatio","newRatio","containsDeep","performance","fn","timeout","timer","setTimeout","node","event","opt_useCapture","addEventListener","attachEvent","removeEventListener","detatchEvent","rect1","rect2","Math","max","min","el","y","x","parentBoundingRect","parentIntersectionRect","child","parentNode","host","assignedSlot","SampleActorType","SampleActorEventType","BaseActor","next","ExampleCommonModule","LazyActor","appearTimer","checkoutDelay","appearDelay","delay","clearTimeout","clearAppearTimer","doAppear","AppearStage","actorMap","Map","onObserveEntries","has","set","intersectionObserver","size","values","entries","appear","disappear","clear"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UAYaA,kBAAkB;QAC7B,8BAAc;UAAA;QAAC;QAAC;UAAA;UAAA,OAKhB,oBAAW;YACT,IAAI,CAACC,aAAa,GAAGC,KAAK,CAACC,IAAI,CAACD,KAAK,CAAC,EAAE,CAAC,CAAC,CAACE,GAAG,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;cACvD,OAAO;gBAAEC,EAAE,EAAED;cAAE,CAAC;YAClB,CAAC,CAAC;YACF,IAAI,CAACE,WAAW,GAAG,IAAI,4EAAW,EAAE;YACpC,IAAI,CAACA,WAAW,CAACC,IAAI,EAAE;UACzB;QAAC;UAAA;UAAA,OAED,6BAAoBC,GAAqB,EAAE;YACzC,IAAQC,IAAI,GAAYD,GAAG,CAAnBC,IAAI;cAAEC,KAAK,GAAKF,GAAG,CAAbE,KAAK;YACnB,QAAQD,IAAI;cACV,KAAK,uGAAoB,CAACE,MAAM;gBAC9B,IAAI,CAACL,WAAW,CAACM,OAAO,CAACF,KAAK,CAAC;gBAC/B;cACF,KAAK,uGAAoB,CAACG,MAAM;gBAC9B,IAAI,CAACP,WAAW,CAACQ,SAAS,CAACJ,KAAK,CAAC;gBACjC;YAAM;UAEZ;QAAC;UAAA;UAAA,OAED,uBAAc;YACZ,IAAI;cACF,IAAI,IAAI,CAACJ,WAAW,EAAE;gBACpB,IAAI,CAACA,WAAW,CAACS,OAAO,EAAE;gBAC1B,IAAI,CAACT,WAAW,GAAG,IAAI;;aAE1B,CAAC,OAAOU,GAAG,EAAE;cACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;;UAEpB;QAAC;QAAA;MAAA,GACF;;;;MApCYlB,kBAAkB,6DAL9B,+DAAS,CAAC;QACTqB,QAAQ,EAAE,oBAAoB;QAC9BC,QAAQ,EAAR,6EAA0C;;OAE3C,CAAC,C,EACWtB,kBAAkB,CAoC9B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCnCYuB,UAAU;QAAA;MAAA,EAAG;MAAbA,UAAU,6DAJtB,8DAAQ,CAAC;QACRC,OAAO,EAAE,CAAC,4DAAY,EAAE,8EAAa,EAAE,0EAAY,EAAE,iGAAmB,CAAC;QACzEC,YAAY,EAAE,CAAC,mFAAkB,EAAE,mFAAkB,EAAE,mFAAkB;OAC1E,CAAC,C,EACWF,UAAU,CAAG;;;;;;;;;;;;;;MCb1B;MAAe;MAAA,2aAA0Y;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MCMzZ,IAAMG,MAAM,GAAW,CACrB;QACEC,IAAI,EAAE,EAAE;QACRC,QAAQ,EAAE,CACR;UACED,IAAI,EAAE,YAAY;UAClBE,SAAS,EAAE;SACZ,EACD;UACEF,IAAI,EAAE,YAAY;UAClBE,SAAS,EAAE;SACZ,EACD;UACEF,IAAI,EAAE,YAAY;UAClBE,SAAS,EAAE;SACZ,EACD;UACEF,IAAI,EAAE,IAAI;UACVE,SAAS,EAAE;SACZ;OAEJ,CACF;UAMYC,aAAa;QAAA;MAAA,EAAG;MAAhBA,aAAa,6DAJzB,8DAAQ,CAAC;QACRN,OAAO,EAAE,CAAC,4DAAY,CAACO,QAAQ,CAACL,MAAM,CAAC,CAAC;QACxCM,OAAO,EAAE,CAAC,4DAAY;OACvB,CAAC,C,EACWF,aAAa,CAAG;;;;;;;;;;;;;;MClC7B;MAAA;MAAA;QAAA;MAAA;MAAA;MAAA;MAAA;MAAA;;MAGA;;;;;;;MAAA,IAOaG,SAAU;QAAA;QAAA;QAAA;UAAA;UAAA;QAAA;QAAA;UAAA;UAAA;UACrB;;;;;UAKA,gBAAOC,KAAiC;YACtC,IAAI,IAAI,CAACC,QAAQ,KAAK,IAAI,EAAE;YAC5B,IAAI,CAACA,QAAQ,GAAG,IAAI;YACpB,IAAI,CAACC,QAAQ,CAAC,yDAAW,CAACC,MAAM,EAAEH,KAAK,CAAC;YACxC,IAAI,IAAI,CAACI,KAAK,EAAE;cACd,IAAI,CAACA,KAAK,CAACtB,SAAS,CAAC,IAAI,CAAC;;UAE9B;QAAC;QAAA;MAAA,EAb4B,qDAAS;;;;;;;;;;;;MCVxC;MAAe;MAAA,oiBAAmgB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCYrgBuB,kBAAkB;QAC7B,8BAAc;UAAA;QAAC;QAAC;UAAA;UAAA,OAKhB,oBAAW;YACT,IAAI,CAACtC,aAAa,GAAGC,KAAK,CAACC,IAAI,CAACD,KAAK,CAAC,EAAE,CAAC,CAAC,CAACE,GAAG,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;cACvD,OAAO;gBAAEC,EAAE,EAAED;cAAE,CAAC;YAClB,CAAC,CAAC;YACF,IAAI,CAACE,WAAW,GAAG,IAAI,4EAAW,EAAE;YACpC,IAAI,CAACA,WAAW,CAACC,IAAI,EAAE;UACzB;QAAC;UAAA;UAAA,OAED,6BAAoBC,GAAqB,EAAE;YACzC,IAAQC,IAAI,GAAYD,GAAG,CAAnBC,IAAI;cAAEC,KAAK,GAAKF,GAAG,CAAbE,KAAK;YACnB,QAAQD,IAAI;cACV,KAAK,uGAAoB,CAACE,MAAM;gBAC9B,IAAI,CAACL,WAAW,CAACM,OAAO,CAACF,KAAK,CAAC;gBAC/B;cACF,KAAK,uGAAoB,CAACG,MAAM;gBAC9B,IAAI,CAACP,WAAW,CAACQ,SAAS,CAACJ,KAAK,CAAC;gBACjC;YAAM;UAEZ;QAAC;UAAA;UAAA,OAED,uBAAc;YACZ,IAAI;cACF,IAAI,IAAI,CAACJ,WAAW,EAAE;gBACpB,IAAI,CAACA,WAAW,CAACS,OAAO,EAAE;gBAC1B,IAAI,CAACT,WAAW,GAAG,IAAI;;aAE1B,CAAC,OAAOU,GAAG,EAAE;cACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;;UAEpB;QAAC;QAAA;MAAA,GACF;;;;MApCYqB,kBAAkB,6DAL9B,+DAAS,CAAC;QACTlB,QAAQ,EAAE,oBAAoB;QAC9BC,QAAQ,EAAR,6EAA0C;;OAE3C,CAAC,C,EACWiB,kBAAkB,CAoC9B;;;;;;;;;;;;;;MC9CD;MAAA;MAAA;QAAA;MAAA;MAAA;MAAA;QAAA;MAAA;MAAA;;;;;MAKA,IAAYC,UAIX;MAJD,WAAYA,UAAU;QACpB,2BAAa;QACb,2BAAa;QACb,2BAAa;MACf,CAAC,EAJWA,UAAU,KAAVA,UAAU;MA+GtB;;;;;MAAA,IAKaC,WAAW;MACtB;;;;MAIA,qBAAY9B,IAAY,EAAE+B,MAA0B,EAAE;QAAA;QACpD,IAAQ9B,KAAK,GAAY8B,MAAM,CAAvB9B,KAAK;UAAEsB,KAAK,GAAKQ,MAAM,CAAhBR,KAAK;QACpB,IAAI,CAACvB,IAAI,GAAGA,IAAI;QAChB,IAAI,CAACC,KAAK,GAAGA,KAAK;QAClB,IAAI,CAACsB,KAAK,GAAGA,KAAK;MACpB,CAAC;MAED;;;MAGgB,YAAAG,MAAM,GAAW,QAAQ;MAEzC;;;MAGgB,YAAAM,SAAS,GAAW,WAAW;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCnIpCC,kBAAkB;QAC7B,8BAAc;UAAA;UAEd,KAAA3C,aAAa,GAAU,EAAE;QAFV;QAAC;UAAA;UAAA,OAKhB,oBAAW;YACT,IAAI,CAACA,aAAa,GAAGC,KAAK,CAACC,IAAI,CAACD,KAAK,CAAC,EAAE,CAAC,CAAC,CAACE,GAAG,CAAC,UAACC,CAAC,EAAEC,CAAC,EAAK;cACvD,OAAO;gBAAEC,EAAE,EAAED;cAAE,CAAC;YAClB,CAAC,CAAC;YACF,IAAI,CAACE,WAAW,GAAG,IAAI,4EAAW,EAAE;YACpC,IAAI,CAACA,WAAW,CAACC,IAAI,EAAE;UACzB;QAAC;UAAA;UAAA,OAED,6BAAoBC,GAAqB,EAAE;YACzC,IAAQC,IAAI,GAAYD,GAAG,CAAnBC,IAAI;cAAEC,KAAK,GAAKF,GAAG,CAAbE,KAAK;YACnB,QAAQD,IAAI;cACV,KAAK,uGAAoB,CAACE,MAAM;gBAC9B,IAAI,CAACL,WAAW,CAACM,OAAO,CAACF,KAAK,CAAC;gBAC/B;cACF,KAAK,uGAAoB,CAACG,MAAM;gBAC9B,IAAI,CAACP,WAAW,CAACQ,SAAS,CAACJ,KAAK,CAAC;gBACjC;YAAM;UAEZ;QAAC;UAAA;UAAA,OAED,uBAAc;YACZ,IAAI;cACF,IAAI,IAAI,CAACJ,WAAW,EAAE;gBACpB,IAAI,CAACA,WAAW,CAACS,OAAO,EAAE;gBAC1B,IAAI,CAACT,WAAW,GAAG,IAAI;;aAE1B,CAAC,OAAOU,GAAG,EAAE;cACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;;UAEpB;QAAC;QAAA;MAAA,GACF;;;;MApCY0B,kBAAkB,6DAL9B,+DAAS,CAAC;QACTvB,QAAQ,EAAE,oBAAoB;QAC9BC,QAAQ,EAAR,6EAA0C;;OAE3C,CAAC,C,EACWsB,kBAAkB,CAoC9B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCpBYC,oBAAoB;QAC/B,8BAAoBC,KAAiB,EAAE;UAAA;UAAnB,KAAAA,KAAK,GAALA,KAAK;UAczB,KAAAC,OAAO,GAAmC,IAAI,0DAAY,EAAE;UAiC5D,KAAAC,WAAW,GAAW,CAAC;UACvB,KAAAC,cAAc,GAAW,CAAC;UA/CxB,IAAI,CAACC,gBAAgB,GAAG,IAAI,iDAAY,EAAE;QAC5C;QAAC;UAAA;UAAA,KAcD,eACiB;YACf,OAAO,CAAC,EAAE,IAAI,CAACtC,KAAK,IAAI,IAAI,CAACA,KAAK,CAACuB,QAAQ,CAAC;UAC9C;QAAC;UAAA;UAAA,OAED,oBAAW;YACT,IAAQgB,aAAa,GAAK,IAAI,CAACL,KAAK,CAA5BK,aAAa;YACrB,QAAQ,IAAI,CAACC,SAAS;cACpB,KAAK,kGAAe,CAACC,IAAI;gBACvB,IAAI,CAACzC,KAAK,GAAG,IAAI,0EAAS,CAACuC,aAAa,CAAC;gBACzC;cACF,KAAK,kGAAe,CAACG,IAAI;gBACvB,IAAI,CAAC1C,KAAK,GAAG,IAAI,0EAAS,CAACuC,aAAa,CAAC;gBACzC,IAAI,CAACvC,KAAK,CAAC2C,gBAAgB,CAAC,IAAI,CAAC;gBACjC,IAAI,CAAC3C,KAAK,CAAC4C,cAAc,CAAC,GAAG,CAAC;gBAC9B;cACF;gBACE,IAAI,CAAC5C,KAAK,GAAG,IAAI,0EAAS,CAACuC,aAAa,CAAC;gBACzC;YAAM;YAGV,IAAMM,kBAAkB,GAAG,IAAI,CAAC7C,KAAK,CAAC8C,MAAM,CAACC,SAAS,CACpD,IAAI,CAACC,aAAa,CAACC,IAAI,CAAC,IAAI,CAAC,CAC9B;YACD,IAAI,CAACX,gBAAgB,CAACY,GAAG,CAACL,kBAAkB,CAAC;YAC7C,IAAI,CAACV,OAAO,CAACgB,IAAI,CAAC;cAChBpD,IAAI,EAAE,uGAAoB,CAACE,MAAM;cACjCD,KAAK,EAAE,IAAI,CAACA;aACb,CAAC;UACJ;QAAC;UAAA;UAAA,OAKD,uBAAcF,GAAgB,EAAE;YAC9B,QAAQA,GAAG,CAACC,IAAI;cACd,KAAK,4EAAW,CAAC0B,MAAM;gBACrB,IAAI,CAACW,WAAW,EAAE;gBAClB;cACF,KAAK,4EAAW,CAACL,SAAS;gBACxB,IAAI,CAACM,cAAc,EAAE;gBACrB;YAAM;UAEZ;QAAC;UAAA;UAAA,OAED,uBAAc;YACZ,IAAI;cACF,IAAI,CAACF,OAAO,CAACgB,IAAI,CAAC;gBAChBpD,IAAI,EAAE,uGAAoB,CAACI,MAAM;gBACjCH,KAAK,EAAE,IAAI,CAACA;eACb,CAAC;cACF,IAAI,IAAI,CAACsC,gBAAgB,EAAE;gBACzB,IAAI,CAACA,gBAAgB,CAACc,WAAW,EAAE;;aAEtC,CAAC,OAAO9C,GAAG,EAAE;cACZC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC;;UAEpB;QAAC;QAAA;MAAA,GACF;;;gBAnGC;QAAU,E;;;;gBAgCT;QAAK;;gBAGL;QAAK;;gBAGL,oDAAM;UAAA,OAAC,aAAa;QAAA;;gBAGpB,yDAAW;UAAA,OAAC,mBAAmB;QAAA;;MAjBrB2B,oBAAoB,6DALhC,+DAAS,CAAC;QACTxB,QAAQ,EAAE,cAAc;QACxBC,QAAQ,EAAR,+EAA4C;;OAE7C,CAAC,C,EACWuB,oBAAoB,CA2EhC;;;;;;;;;;;;;;MCvGD;MAAe;MAAA,oiBAAmgB;;;;;;;;;;;;MCAlhB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;MACC,aAAW;QACZ,YAAY;;QAEZ;QACA,IAAI,OAAOoB,MAAM,KAAK,QAAQ,EAAE;UAC9B;QACF;;QAEA;QACA;QACA,IAAI,sBAAsB,IAAIA,MAAM,IAChC,2BAA2B,IAAIA,MAAM,IACrC,mBAAmB,IAAIA,MAAM,CAACC,yBAAyB,CAACC,SAAS,EAAE;UAErE;UACA;UACA,IAAI,EAAE,gBAAgB,IAAIF,MAAM,CAACC,yBAAyB,CAACC,SAAS,CAAC,EAAE;YACrEC,MAAM,CAACC,cAAc,CAACJ,MAAM,CAACC,yBAAyB,CAACC,SAAS,EAC9D,gBAAgB,EAAE;cAClBG,GAAG,EAAE,eAAY;gBACf,OAAO,IAAI,CAACC,iBAAiB,GAAG,CAAC;cACnC;YACF,CAAC,CAAC;UACJ;UACA;QACF;;QAEA;AACA;AACA;AACA;AACA;QACA,SAASC,eAAe,CAACC,GAAG,EAAE;UAC5B,IAAI;YACF,OAAOA,GAAG,CAACC,WAAW,IAAID,GAAG,CAACC,WAAW,CAACC,YAAY,IAAI,IAAI;UAChE,CAAC,CAAC,OAAOC,CAAC,EAAE;YACV;YACA,OAAO,IAAI;UACb;QACF;;QAEA;AACA;AACA;QACA,IAAIC,QAAQ,GAAI,UAASC,QAAQ,EAAE;UACjC,IAAIL,GAAG,GAAGK,QAAQ;UAClB,IAAIC,KAAK,GAAGP,eAAe,CAACC,GAAG,CAAC;UAChC,OAAOM,KAAK,EAAE;YACZN,GAAG,GAAGM,KAAK,CAACC,aAAa;YACzBD,KAAK,GAAGP,eAAe,CAACC,GAAG,CAAC;UAC9B;UACA,OAAOA,GAAG;QACZ,CAAC,CAAER,MAAM,CAACY,QAAQ,CAAC;;QAEnB;AACA;AACA;AACA;AACA;AACA;QACA,IAAII,QAAQ,GAAG,EAAE;;QAEjB;AACA;AACA;AACA;AACA;QACA,IAAIC,kBAAkB,GAAG,IAAI;;QAE7B;AACA;AACA;AACA;QACA,IAAIC,eAAe,GAAG,IAAI;;QAG1B;AACA;AACA;AACA;AACA;AACA;QACA,SAASjB,yBAAyB,CAAChC,KAAK,EAAE;UACxC,IAAI,CAACkD,IAAI,GAAGlD,KAAK,CAACkD,IAAI;UACtB,IAAI,CAACC,MAAM,GAAGnD,KAAK,CAACmD,MAAM;UAC1B,IAAI,CAACC,UAAU,GAAGC,aAAa,CAACrD,KAAK,CAACoD,UAAU,CAAC;UACjD,IAAI,CAACE,kBAAkB,GAAGD,aAAa,CAACrD,KAAK,CAACsD,kBAAkB,CAAC;UACjE,IAAI,CAACC,gBAAgB,GAAGF,aAAa,CAACrD,KAAK,CAACuD,gBAAgB,IAAIC,YAAY,EAAE,CAAC;UAC/E,IAAI,CAACC,cAAc,GAAG,CAAC,CAACzD,KAAK,CAACuD,gBAAgB;;UAE9C;UACA,IAAIG,UAAU,GAAG,IAAI,CAACJ,kBAAkB;UACxC,IAAIK,UAAU,GAAGD,UAAU,CAACE,KAAK,GAAGF,UAAU,CAACG,MAAM;UACrD,IAAIN,gBAAgB,GAAG,IAAI,CAACA,gBAAgB;UAC5C,IAAIO,gBAAgB,GAAGP,gBAAgB,CAACK,KAAK,GAAGL,gBAAgB,CAACM,MAAM;;UAEvE;UACA,IAAIF,UAAU,EAAE;YACd;YACA;YACA,IAAI,CAACtB,iBAAiB,GAAG0B,MAAM,CAAC,CAACD,gBAAgB,GAAGH,UAAU,EAAEK,OAAO,CAAC,CAAC,CAAC,CAAC;UAC7E,CAAC,MAAM;YACL;YACA,IAAI,CAAC3B,iBAAiB,GAAG,IAAI,CAACoB,cAAc,GAAG,CAAC,GAAG,CAAC;UACtD;QACF;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAASQ,oBAAoB,CAACC,QAAQ,EAAEC,WAAW,EAAE;UAEnD,IAAIC,OAAO,GAAGD,WAAW,IAAI,CAAC,CAAC;UAE/B,IAAI,OAAOD,QAAQ,IAAI,UAAU,EAAE;YACjC,MAAM,IAAIG,KAAK,CAAC,6BAA6B,CAAC;UAChD;UAEA,IAAID,OAAO,CAACE,IAAI,IAAIF,OAAO,CAACE,IAAI,CAACC,QAAQ,IAAI,CAAC,EAAE;YAC9C,MAAM,IAAIF,KAAK,CAAC,yBAAyB,CAAC;UAC5C;;UAEA;UACA,IAAI,CAACG,sBAAsB,GAAGC,QAAQ,CAClC,IAAI,CAACD,sBAAsB,CAAC7C,IAAI,CAAC,IAAI,CAAC,EAAE,IAAI,CAAC+C,gBAAgB,CAAC;;UAElE;UACA,IAAI,CAACC,SAAS,GAAGT,QAAQ;UACzB,IAAI,CAACU,mBAAmB,GAAG,EAAE;UAC7B,IAAI,CAACC,cAAc,GAAG,EAAE;UACxB,IAAI,CAACC,iBAAiB,GAAG,IAAI,CAACC,gBAAgB,CAACX,OAAO,CAACY,UAAU,CAAC;;UAElE;UACA,IAAI,CAACC,UAAU,GAAG,IAAI,CAACC,eAAe,CAACd,OAAO,CAACe,SAAS,CAAC;UACzD,IAAI,CAACb,IAAI,GAAGF,OAAO,CAACE,IAAI,IAAI,IAAI;UAChC,IAAI,CAACU,UAAU,GAAG,IAAI,CAACF,iBAAiB,CAAC5G,GAAG,CAAC,UAASkH,MAAM,EAAE;YAC5D,OAAOA,MAAM,CAACC,KAAK,GAAGD,MAAM,CAACE,IAAI;UACnC,CAAC,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;;UAEZ;UACA,IAAI,CAACC,oBAAoB,GAAG,EAAE;UAC9B;UACA,IAAI,CAACC,uBAAuB,GAAG,EAAE;QACnC;;QAGA;AACA;AACA;AACA;QACAxB,oBAAoB,CAAChC,SAAS,CAACyC,gBAAgB,GAAG,GAAG;;QAGrD;AACA;AACA;AACA;AACA;QACAT,oBAAoB,CAAChC,SAAS,CAACyD,aAAa,GAAG,IAAI;;QAEnD;AACA;AACA;AACA;QACAzB,oBAAoB,CAAChC,SAAS,CAAC0D,qBAAqB,GAAG,IAAI;;QAG3D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA1B,oBAAoB,CAAC2B,wBAAwB,GAAG,YAAW;UACzD,IAAI,CAAC5C,kBAAkB,EAAE;YACvB;AACJ;AACA;AACA;YACIA,kBAAkB,GAAG,4BAASM,kBAAkB,EAAEC,gBAAgB,EAAE;cAClE,IAAI,CAACD,kBAAkB,IAAI,CAACC,gBAAgB,EAAE;gBAC5CN,eAAe,GAAGO,YAAY,EAAE;cAClC,CAAC,MAAM;gBACLP,eAAe,GAAG4C,qBAAqB,CAACvC,kBAAkB,EAAEC,gBAAgB,CAAC;cAC/E;cACAR,QAAQ,CAAC+C,OAAO,CAAC,UAASC,QAAQ,EAAE;gBAClCA,QAAQ,CAACvB,sBAAsB,EAAE;cACnC,CAAC,CAAC;YACJ,CAAC;UACH;UACA,OAAOxB,kBAAkB;QAC3B,CAAC;;QAGD;AACA;AACA;QACAiB,oBAAoB,CAAC+B,wBAAwB,GAAG,YAAW;UACzDhD,kBAAkB,GAAG,IAAI;UACzBC,eAAe,GAAG,IAAI;QACxB,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACAgB,oBAAoB,CAAChC,SAAS,CAACrD,OAAO,GAAG,UAASuE,MAAM,EAAE;UACxD,IAAI8C,uBAAuB,GAAG,IAAI,CAACrB,mBAAmB,CAACsB,IAAI,CAAC,UAASC,IAAI,EAAE;YACzE,OAAOA,IAAI,CAACC,OAAO,IAAIjD,MAAM;UAC/B,CAAC,CAAC;UAEF,IAAI8C,uBAAuB,EAAE;YAC3B;UACF;UAEA,IAAI,EAAE9C,MAAM,IAAIA,MAAM,CAACoB,QAAQ,IAAI,CAAC,CAAC,EAAE;YACrC,MAAM,IAAIF,KAAK,CAAC,2BAA2B,CAAC;UAC9C;UAEA,IAAI,CAACgC,iBAAiB,EAAE;UACxB,IAAI,CAACzB,mBAAmB,CAAC0B,IAAI,CAAC;YAACF,OAAO,EAAEjD,MAAM;YAAEnD,KAAK,EAAE;UAAI,CAAC,CAAC;UAC7D,IAAI,CAACuG,qBAAqB,CAACpD,MAAM,CAACL,aAAa,CAAC;UAChD,IAAI,CAAC0B,sBAAsB,EAAE;QAC/B,CAAC;;QAGD;AACA;AACA;AACA;QACAP,oBAAoB,CAAChC,SAAS,CAACnD,SAAS,GAAG,UAASqE,MAAM,EAAE;UAC1D,IAAI,CAACyB,mBAAmB,GACpB,IAAI,CAACA,mBAAmB,CAAC4B,MAAM,CAAC,UAASL,IAAI,EAAE;YAC7C,OAAOA,IAAI,CAACC,OAAO,IAAIjD,MAAM;UAC/B,CAAC,CAAC;UACN,IAAI,CAACsD,uBAAuB,CAACtD,MAAM,CAACL,aAAa,CAAC;UAClD,IAAI,IAAI,CAAC8B,mBAAmB,CAAC8B,MAAM,IAAI,CAAC,EAAE;YACxC,IAAI,CAACC,mBAAmB,EAAE;UAC5B;QACF,CAAC;;QAGD;AACA;AACA;QACA1C,oBAAoB,CAAChC,SAAS,CAAC2E,UAAU,GAAG,YAAW;UACrD,IAAI,CAAChC,mBAAmB,GAAG,EAAE;UAC7B,IAAI,CAACiC,0BAA0B,EAAE;UACjC,IAAI,CAACF,mBAAmB,EAAE;QAC5B,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;QACA1C,oBAAoB,CAAChC,SAAS,CAAC6E,WAAW,GAAG,YAAW;UACtD,IAAIC,OAAO,GAAG,IAAI,CAAClC,cAAc,CAACmC,KAAK,EAAE;UACzC,IAAI,CAACnC,cAAc,GAAG,EAAE;UACxB,OAAOkC,OAAO;QAChB,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA9C,oBAAoB,CAAChC,SAAS,CAACiD,eAAe,GAAG,UAAS+B,aAAa,EAAE;UACvE,IAAI9B,SAAS,GAAG8B,aAAa,IAAI,CAAC,CAAC,CAAC;UACpC,IAAI,CAACjJ,KAAK,CAACkJ,OAAO,CAAC/B,SAAS,CAAC,EAAEA,SAAS,GAAG,CAACA,SAAS,CAAC;UAEtD,OAAOA,SAAS,CAACgC,IAAI,EAAE,CAACX,MAAM,CAAC,UAASY,CAAC,EAAEC,CAAC,EAAElJ,CAAC,EAAE;YAC/C,IAAI,OAAOiJ,CAAC,IAAI,QAAQ,IAAIE,KAAK,CAACF,CAAC,CAAC,IAAIA,CAAC,GAAG,CAAC,IAAIA,CAAC,GAAG,CAAC,EAAE;cACtD,MAAM,IAAI/C,KAAK,CAAC,wDAAwD,CAAC;YAC3E;YACA,OAAO+C,CAAC,KAAKjJ,CAAC,CAACkJ,CAAC,GAAG,CAAC,CAAC;UACvB,CAAC,CAAC;QACJ,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACApD,oBAAoB,CAAChC,SAAS,CAAC8C,gBAAgB,GAAG,UAASwC,cAAc,EAAE;UACzE,IAAIC,YAAY,GAAGD,cAAc,IAAI,KAAK;UAC1C,IAAIE,OAAO,GAAGD,YAAY,CAACE,KAAK,CAAC,KAAK,CAAC,CAACxJ,GAAG,CAAC,UAASkH,MAAM,EAAE;YAC3D,IAAIuC,KAAK,GAAG,uBAAuB,CAACC,IAAI,CAACxC,MAAM,CAAC;YAChD,IAAI,CAACuC,KAAK,EAAE;cACV,MAAM,IAAItD,KAAK,CAAC,mDAAmD,CAAC;YACtE;YACA,OAAO;cAACgB,KAAK,EAAEwC,UAAU,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC;cAAErC,IAAI,EAAEqC,KAAK,CAAC,CAAC;YAAC,CAAC;UACtD,CAAC,CAAC;;UAEF;UACAF,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO,CAAC,CAAC,CAAC,IAAIA,OAAO,CAAC,CAAC,CAAC;UACrCA,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO,CAAC,CAAC,CAAC,IAAIA,OAAO,CAAC,CAAC,CAAC;UACrCA,OAAO,CAAC,CAAC,CAAC,GAAGA,OAAO,CAAC,CAAC,CAAC,IAAIA,OAAO,CAAC,CAAC,CAAC;UAErC,OAAOA,OAAO;QAChB,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;QACAxD,oBAAoB,CAAChC,SAAS,CAACsE,qBAAqB,GAAG,UAAShE,GAAG,EAAE;UACnE,IAAIuF,GAAG,GAAGvF,GAAG,CAACC,WAAW;UACzB,IAAI,CAACsF,GAAG,EAAE;YACR;YACA;UACF;UACA,IAAI,IAAI,CAACtC,oBAAoB,CAACuC,OAAO,CAACxF,GAAG,CAAC,IAAI,CAAC,CAAC,EAAE;YAChD;YACA;UACF;;UAEA;UACA,IAAI2B,QAAQ,GAAG,IAAI,CAACM,sBAAsB;UAC1C,IAAIwD,kBAAkB,GAAG,IAAI;UAC7B,IAAIC,WAAW,GAAG,IAAI;;UAEtB;UACA;UACA,IAAI,IAAI,CAACvC,aAAa,EAAE;YACtBsC,kBAAkB,GAAGF,GAAG,CAACI,WAAW,CAAChE,QAAQ,EAAE,IAAI,CAACwB,aAAa,CAAC;UACpE,CAAC,MAAM;YACLyC,QAAQ,CAACL,GAAG,EAAE,QAAQ,EAAE5D,QAAQ,EAAE,IAAI,CAAC;YACvCiE,QAAQ,CAAC5F,GAAG,EAAE,QAAQ,EAAE2B,QAAQ,EAAE,IAAI,CAAC;YACvC,IAAI,IAAI,CAACyB,qBAAqB,IAAI,kBAAkB,IAAImC,GAAG,EAAE;cAC3DG,WAAW,GAAG,IAAIH,GAAG,CAACM,gBAAgB,CAAClE,QAAQ,CAAC;cAChD+D,WAAW,CAACrJ,OAAO,CAAC2D,GAAG,EAAE;gBACvB8F,UAAU,EAAE,IAAI;gBAChBC,SAAS,EAAE,IAAI;gBACfC,aAAa,EAAE,IAAI;gBACnBC,OAAO,EAAE;cACX,CAAC,CAAC;YACJ;UACF;UAEA,IAAI,CAAChD,oBAAoB,CAACc,IAAI,CAAC/D,GAAG,CAAC;UACnC,IAAI,CAACkD,uBAAuB,CAACa,IAAI,CAAC,YAAW;YAC3C;YACA;YACA,IAAIwB,GAAG,GAAGvF,GAAG,CAACC,WAAW;YAEzB,IAAIsF,GAAG,EAAE;cACP,IAAIE,kBAAkB,EAAE;gBACtBF,GAAG,CAACW,aAAa,CAACT,kBAAkB,CAAC;cACvC;cACAU,WAAW,CAACZ,GAAG,EAAE,QAAQ,EAAE5D,QAAQ,EAAE,IAAI,CAAC;YAC5C;YAEAwE,WAAW,CAACnG,GAAG,EAAE,QAAQ,EAAE2B,QAAQ,EAAE,IAAI,CAAC;YAC1C,IAAI+D,WAAW,EAAE;cACfA,WAAW,CAACrB,UAAU,EAAE;YAC1B;UACF,CAAC,CAAC;;UAEF;UACA,IAAIrE,GAAG,KAAK,IAAI,CAAC+B,IAAI,IAAI,IAAI,CAACA,IAAI,CAACxB,aAAa,IAAIH,QAAQ,CAAC,EAAE;YAC7D,IAAIE,KAAK,GAAGP,eAAe,CAACC,GAAG,CAAC;YAChC,IAAIM,KAAK,EAAE;cACT,IAAI,CAAC0D,qBAAqB,CAAC1D,KAAK,CAACC,aAAa,CAAC;YACjD;UACF;QACF,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACAmB,oBAAoB,CAAChC,SAAS,CAACwE,uBAAuB,GAAG,UAASlE,GAAG,EAAE;UACrE,IAAIoG,KAAK,GAAG,IAAI,CAACnD,oBAAoB,CAACuC,OAAO,CAACxF,GAAG,CAAC;UAClD,IAAIoG,KAAK,IAAI,CAAC,CAAC,EAAE;YACf;UACF;UAEA,IAAIC,OAAO,GAAI,IAAI,CAACtE,IAAI,IAAI,IAAI,CAACA,IAAI,CAACxB,aAAa,IAAIH,QAAS;;UAEhE;UACA,IAAIkG,mBAAmB,GACnB,IAAI,CAACjE,mBAAmB,CAACsB,IAAI,CAAC,UAASC,IAAI,EAAE;YAC3C,IAAI2C,OAAO,GAAG3C,IAAI,CAACC,OAAO,CAACtD,aAAa;YACxC;YACA,IAAIgG,OAAO,IAAIvG,GAAG,EAAE;cAClB,OAAO,IAAI;YACb;YACA;YACA,OAAOuG,OAAO,IAAIA,OAAO,IAAIF,OAAO,EAAE;cACpC,IAAI/F,KAAK,GAAGP,eAAe,CAACwG,OAAO,CAAC;cACpCA,OAAO,GAAGjG,KAAK,IAAIA,KAAK,CAACC,aAAa;cACtC,IAAIgG,OAAO,IAAIvG,GAAG,EAAE;gBAClB,OAAO,IAAI;cACb;YACF;YACA,OAAO,KAAK;UACd,CAAC,CAAC;UACN,IAAIsG,mBAAmB,EAAE;YACvB;UACF;;UAEA;UACA,IAAI/G,WAAW,GAAG,IAAI,CAAC2D,uBAAuB,CAACkD,KAAK,CAAC;UACrD,IAAI,CAACnD,oBAAoB,CAACuD,MAAM,CAACJ,KAAK,EAAE,CAAC,CAAC;UAC1C,IAAI,CAAClD,uBAAuB,CAACsD,MAAM,CAACJ,KAAK,EAAE,CAAC,CAAC;UAC7C7G,WAAW,EAAE;;UAEb;UACA,IAAIS,GAAG,IAAIqG,OAAO,EAAE;YAClB,IAAI/F,KAAK,GAAGP,eAAe,CAACC,GAAG,CAAC;YAChC,IAAIM,KAAK,EAAE;cACT,IAAI,CAAC4D,uBAAuB,CAAC5D,KAAK,CAACC,aAAa,CAAC;YACnD;UACF;QACF,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACAmB,oBAAoB,CAAChC,SAAS,CAAC4E,0BAA0B,GAAG,YAAW;UACrE,IAAImC,YAAY,GAAG,IAAI,CAACvD,uBAAuB,CAACuB,KAAK,CAAC,CAAC,CAAC;UACxD,IAAI,CAACxB,oBAAoB,CAACkB,MAAM,GAAG,CAAC;UACpC,IAAI,CAACjB,uBAAuB,CAACiB,MAAM,GAAG,CAAC;UACvC,KAAK,IAAIW,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG2B,YAAY,CAACtC,MAAM,EAAEW,CAAC,EAAE,EAAE;YAC5C2B,YAAY,CAAC3B,CAAC,CAAC,EAAE;UACnB;QACF,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;QACApD,oBAAoB,CAAChC,SAAS,CAACuC,sBAAsB,GAAG,YAAW;UACjE,IAAI,CAAC,IAAI,CAACF,IAAI,IAAItB,kBAAkB,IAAI,CAACC,eAAe,EAAE;YACxD;YACA;UACF;UAEA,IAAIgG,WAAW,GAAG,IAAI,CAACC,YAAY,EAAE;UACrC,IAAIC,QAAQ,GAAGF,WAAW,GAAG,IAAI,CAACG,YAAY,EAAE,GAAG5F,YAAY,EAAE;UAEjE,IAAI,CAACoB,mBAAmB,CAACkB,OAAO,CAAC,UAASK,IAAI,EAAE;YAC9C,IAAIhD,MAAM,GAAGgD,IAAI,CAACC,OAAO;YACzB,IAAI1C,UAAU,GAAG2F,qBAAqB,CAAClG,MAAM,CAAC;YAC9C,IAAImG,kBAAkB,GAAG,IAAI,CAACC,mBAAmB,CAACpG,MAAM,CAAC;YACzD,IAAIqG,QAAQ,GAAGrD,IAAI,CAACnG,KAAK;YACzB,IAAIuD,gBAAgB,GAAG0F,WAAW,IAAIK,kBAAkB,IACpD,IAAI,CAACG,iCAAiC,CAACtG,MAAM,EAAEO,UAAU,EAAEyF,QAAQ,CAAC;YAExE,IAAIO,QAAQ,GAAGvD,IAAI,CAACnG,KAAK,GAAG,IAAIgC,yBAAyB,CAAC;cACxDkB,IAAI,EAAEyG,GAAG,EAAE;cACXxG,MAAM,EAAEA,MAAM;cACdG,kBAAkB,EAAEI,UAAU;cAC9BN,UAAU,EAAEJ,kBAAkB,IAAI,CAAC,IAAI,CAACsB,IAAI,GAAG,IAAI,GAAG6E,QAAQ;cAC9D5F,gBAAgB,EAAEA;YACpB,CAAC,CAAC;YAEF,IAAI,CAACiG,QAAQ,EAAE;cACb,IAAI,CAAC3E,cAAc,CAACyB,IAAI,CAACoD,QAAQ,CAAC;YACpC,CAAC,MAAM,IAAIT,WAAW,IAAIK,kBAAkB,EAAE;cAC5C;cACA;cACA,IAAI,IAAI,CAACM,oBAAoB,CAACJ,QAAQ,EAAEE,QAAQ,CAAC,EAAE;gBACjD,IAAI,CAAC7E,cAAc,CAACyB,IAAI,CAACoD,QAAQ,CAAC;cACpC;YACF,CAAC,MAAM;cACL;cACA;cACA;cACA,IAAIF,QAAQ,IAAIA,QAAQ,CAAC/F,cAAc,EAAE;gBACvC,IAAI,CAACoB,cAAc,CAACyB,IAAI,CAACoD,QAAQ,CAAC;cACpC;YACF;UACF,CAAC,EAAE,IAAI,CAAC;UAER,IAAI,IAAI,CAAC7E,cAAc,CAAC6B,MAAM,EAAE;YAC9B,IAAI,CAAC/B,SAAS,CAAC,IAAI,CAACmC,WAAW,EAAE,EAAE,IAAI,CAAC;UAC1C;QACF,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA7C,oBAAoB,CAAChC,SAAS,CAACwH,iCAAiC,GAC5D,UAAStG,MAAM,EAAEO,UAAU,EAAEyF,QAAQ,EAAE;UACzC;UACA,IAAIpH,MAAM,CAAC8H,gBAAgB,CAAC1G,MAAM,CAAC,CAAC2G,OAAO,IAAI,MAAM,EAAE;UAEvD,IAAIvG,gBAAgB,GAAGG,UAAU;UACjC,IAAIqG,MAAM,GAAGC,aAAa,CAAC7G,MAAM,CAAC;UAClC,IAAI8G,MAAM,GAAG,KAAK;UAElB,OAAO,CAACA,MAAM,IAAIF,MAAM,EAAE;YACxB,IAAIG,UAAU,GAAG,IAAI;YACrB,IAAIC,mBAAmB,GAAGJ,MAAM,CAACxF,QAAQ,IAAI,CAAC,GAC1CxC,MAAM,CAAC8H,gBAAgB,CAACE,MAAM,CAAC,GAAG,CAAC,CAAC;;YAExC;YACA,IAAII,mBAAmB,CAACL,OAAO,IAAI,MAAM,EAAE,OAAO,IAAI;YAEtD,IAAIC,MAAM,IAAI,IAAI,CAACzF,IAAI,IAAIyF,MAAM,CAACxF,QAAQ,IAAI,cAAe,CAAC,EAAE;cAC9D0F,MAAM,GAAG,IAAI;cACb,IAAIF,MAAM,IAAI,IAAI,CAACzF,IAAI,IAAIyF,MAAM,IAAIpH,QAAQ,EAAE;gBAC7C,IAAIK,kBAAkB,IAAI,CAAC,IAAI,CAACsB,IAAI,EAAE;kBACpC,IAAI,CAACrB,eAAe,IAChBA,eAAe,CAACW,KAAK,IAAI,CAAC,IAAIX,eAAe,CAACY,MAAM,IAAI,CAAC,EAAE;oBAC7D;oBACAkG,MAAM,GAAG,IAAI;oBACbG,UAAU,GAAG,IAAI;oBACjB3G,gBAAgB,GAAG,IAAI;kBACzB,CAAC,MAAM;oBACL2G,UAAU,GAAGjH,eAAe;kBAC9B;gBACF,CAAC,MAAM;kBACLiH,UAAU,GAAGf,QAAQ;gBACvB;cACF,CAAC,MAAM;gBACL;gBACA,IAAItG,KAAK,GAAGmH,aAAa,CAACD,MAAM,CAAC;gBACjC,IAAIK,SAAS,GAAGvH,KAAK,IAAIwG,qBAAqB,CAACxG,KAAK,CAAC;gBACrD,IAAIwH,cAAc,GACdxH,KAAK,IACL,IAAI,CAAC4G,iCAAiC,CAAC5G,KAAK,EAAEuH,SAAS,EAAEjB,QAAQ,CAAC;gBACtE,IAAIiB,SAAS,IAAIC,cAAc,EAAE;kBAC/BN,MAAM,GAAGlH,KAAK;kBACdqH,UAAU,GAAGrE,qBAAqB,CAACuE,SAAS,EAAEC,cAAc,CAAC;gBAC/D,CAAC,MAAM;kBACLN,MAAM,GAAG,IAAI;kBACbxG,gBAAgB,GAAG,IAAI;gBACzB;cACF;YACF,CAAC,MAAM;cACL;cACA;cACA;cACA;cACA,IAAIhB,GAAG,GAAGwH,MAAM,CAACjH,aAAa;cAC9B,IAAIiH,MAAM,IAAIxH,GAAG,CAAC+H,IAAI,IAClBP,MAAM,IAAIxH,GAAG,CAACgI,eAAe,IAC7BJ,mBAAmB,CAACK,QAAQ,IAAI,SAAS,EAAE;gBAC7CN,UAAU,GAAGb,qBAAqB,CAACU,MAAM,CAAC;cAC5C;YACF;;YAEA;YACA;YACA,IAAIG,UAAU,EAAE;cACd3G,gBAAgB,GAAGkH,uBAAuB,CAACP,UAAU,EAAE3G,gBAAgB,CAAC;YAC1E;YACA,IAAI,CAACA,gBAAgB,EAAE;YACvBwG,MAAM,GAAGA,MAAM,IAAIC,aAAa,CAACD,MAAM,CAAC;UAC1C;UACA,OAAOxG,gBAAgB;QACzB,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACAU,oBAAoB,CAAChC,SAAS,CAACmH,YAAY,GAAG,YAAW;UACvD,IAAID,QAAQ;UACZ,IAAI,IAAI,CAAC7E,IAAI,EAAE;YACb6E,QAAQ,GAAGE,qBAAqB,CAAC,IAAI,CAAC/E,IAAI,CAAC;UAC7C,CAAC,MAAM;YACL;YACA,IAAIoG,IAAI,GAAG/H,QAAQ,CAAC4H,eAAe;YACnC,IAAID,IAAI,GAAG3H,QAAQ,CAAC2H,IAAI;YACxBnB,QAAQ,GAAG;cACTwB,GAAG,EAAE,CAAC;cACNC,IAAI,EAAE,CAAC;cACPC,KAAK,EAAEH,IAAI,CAACI,WAAW,IAAIR,IAAI,CAACQ,WAAW;cAC3ClH,KAAK,EAAE8G,IAAI,CAACI,WAAW,IAAIR,IAAI,CAACQ,WAAW;cAC3CC,MAAM,EAAEL,IAAI,CAACM,YAAY,IAAIV,IAAI,CAACU,YAAY;cAC9CnH,MAAM,EAAE6G,IAAI,CAACM,YAAY,IAAIV,IAAI,CAACU;YACpC,CAAC;UACH;UACA,OAAO,IAAI,CAACC,uBAAuB,CAAC9B,QAAQ,CAAC;QAC/C,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;QACAlF,oBAAoB,CAAChC,SAAS,CAACgJ,uBAAuB,GAAG,UAASC,IAAI,EAAE;UACtE,IAAIzD,OAAO,GAAG,IAAI,CAAC3C,iBAAiB,CAAC5G,GAAG,CAAC,UAASkH,MAAM,EAAEiC,CAAC,EAAE;YAC3D,OAAOjC,MAAM,CAACE,IAAI,IAAI,IAAI,GAAGF,MAAM,CAACC,KAAK,GACrCD,MAAM,CAACC,KAAK,IAAIgC,CAAC,GAAG,CAAC,GAAG6D,IAAI,CAACtH,KAAK,GAAGsH,IAAI,CAACrH,MAAM,CAAC,GAAG,GAAG;UAC7D,CAAC,CAAC;UACF,IAAIsH,OAAO,GAAG;YACZR,GAAG,EAAEO,IAAI,CAACP,GAAG,GAAGlD,OAAO,CAAC,CAAC,CAAC;YAC1BoD,KAAK,EAAEK,IAAI,CAACL,KAAK,GAAGpD,OAAO,CAAC,CAAC,CAAC;YAC9BsD,MAAM,EAAEG,IAAI,CAACH,MAAM,GAAGtD,OAAO,CAAC,CAAC,CAAC;YAChCmD,IAAI,EAAEM,IAAI,CAACN,IAAI,GAAGnD,OAAO,CAAC,CAAC;UAC7B,CAAC;UACD0D,OAAO,CAACvH,KAAK,GAAGuH,OAAO,CAACN,KAAK,GAAGM,OAAO,CAACP,IAAI;UAC5CO,OAAO,CAACtH,MAAM,GAAGsH,OAAO,CAACJ,MAAM,GAAGI,OAAO,CAACR,GAAG;UAE7C,OAAOQ,OAAO;QAChB,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACAlH,oBAAoB,CAAChC,SAAS,CAAC2H,oBAAoB,GAC/C,UAASJ,QAAQ,EAAEE,QAAQ,EAAE;UAE/B;UACA;UACA,IAAI0B,QAAQ,GAAG5B,QAAQ,IAAIA,QAAQ,CAAC/F,cAAc,GAC9C+F,QAAQ,CAACnH,iBAAiB,IAAI,CAAC,GAAG,CAAC,CAAC;UACxC,IAAIgJ,QAAQ,GAAG3B,QAAQ,CAACjG,cAAc,GAClCiG,QAAQ,CAACrH,iBAAiB,IAAI,CAAC,GAAG,CAAC,CAAC;;UAExC;UACA,IAAI+I,QAAQ,KAAKC,QAAQ,EAAE;UAE3B,KAAK,IAAIhE,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,IAAI,CAACpC,UAAU,CAACyB,MAAM,EAAEW,CAAC,EAAE,EAAE;YAC/C,IAAIlC,SAAS,GAAG,IAAI,CAACF,UAAU,CAACoC,CAAC,CAAC;;YAElC;YACA;YACA,IAAIlC,SAAS,IAAIiG,QAAQ,IAAIjG,SAAS,IAAIkG,QAAQ,IAC9ClG,SAAS,GAAGiG,QAAQ,KAAKjG,SAAS,GAAGkG,QAAQ,EAAE;cACjD,OAAO,IAAI;YACb;UACF;QACF,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACApH,oBAAoB,CAAChC,SAAS,CAACiH,YAAY,GAAG,YAAW;UACvD,OAAO,CAAC,IAAI,CAAC5E,IAAI,IAAIgH,YAAY,CAAC3I,QAAQ,EAAE,IAAI,CAAC2B,IAAI,CAAC;QACxD,CAAC;;QAGD;AACA;AACA;AACA;AACA;AACA;QACAL,oBAAoB,CAAChC,SAAS,CAACsH,mBAAmB,GAAG,UAASpG,MAAM,EAAE;UACpE,OAAOmI,YAAY,CAAC,IAAI,CAAChH,IAAI,IAAI3B,QAAQ,EAAEQ,MAAM,CAAC,KAC/C,CAAC,IAAI,CAACmB,IAAI,IAAI,IAAI,CAACA,IAAI,CAACxB,aAAa,IAAIK,MAAM,CAACL,aAAa,CAAC;QACnE,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACAmB,oBAAoB,CAAChC,SAAS,CAACoE,iBAAiB,GAAG,YAAW;UAC5D,IAAItD,QAAQ,CAACgF,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE;YAC9BhF,QAAQ,CAACuD,IAAI,CAAC,IAAI,CAAC;UACrB;QACF,CAAC;;QAGD;AACA;AACA;AACA;QACArC,oBAAoB,CAAChC,SAAS,CAAC0E,mBAAmB,GAAG,YAAW;UAC9D,IAAIgC,KAAK,GAAG5F,QAAQ,CAACgF,OAAO,CAAC,IAAI,CAAC;UAClC,IAAIY,KAAK,IAAI,CAAC,CAAC,EAAE5F,QAAQ,CAACgG,MAAM,CAACJ,KAAK,EAAE,CAAC,CAAC;QAC5C,CAAC;;QAGD;AACA;AACA;AACA;AACA;QACA,SAASgB,GAAG,GAAG;UACb,OAAO5H,MAAM,CAACwJ,WAAW,IAAIA,WAAW,CAAC5B,GAAG,IAAI4B,WAAW,CAAC5B,GAAG,EAAE;QACnE;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAASlF,QAAQ,CAAC+G,EAAE,EAAEC,OAAO,EAAE;UAC7B,IAAIC,KAAK,GAAG,IAAI;UAChB,OAAO,YAAY;YACjB,IAAI,CAACA,KAAK,EAAE;cACVA,KAAK,GAAGC,UAAU,CAAC,YAAW;gBAC5BH,EAAE,EAAE;gBACJE,KAAK,GAAG,IAAI;cACd,CAAC,EAAED,OAAO,CAAC;YACb;UACF,CAAC;QACH;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAAStD,QAAQ,CAACyD,IAAI,EAAEC,KAAK,EAAEL,EAAE,EAAEM,cAAc,EAAE;UACjD,IAAI,OAAOF,IAAI,CAACG,gBAAgB,IAAI,UAAU,EAAE;YAC9CH,IAAI,CAACG,gBAAgB,CAACF,KAAK,EAAEL,EAAE,EAAEM,cAAc,IAAI,KAAK,CAAC;UAC3D,CAAC,MACI,IAAI,OAAOF,IAAI,CAACI,WAAW,IAAI,UAAU,EAAE;YAC9CJ,IAAI,CAACI,WAAW,CAAC,IAAI,GAAGH,KAAK,EAAEL,EAAE,CAAC;UACpC;QACF;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAAS9C,WAAW,CAACkD,IAAI,EAAEC,KAAK,EAAEL,EAAE,EAAEM,cAAc,EAAE;UACpD,IAAI,OAAOF,IAAI,CAACK,mBAAmB,IAAI,UAAU,EAAE;YACjDL,IAAI,CAACK,mBAAmB,CAACJ,KAAK,EAAEL,EAAE,EAAEM,cAAc,IAAI,KAAK,CAAC;UAC9D,CAAC,MACI,IAAI,OAAOF,IAAI,CAACM,YAAY,IAAI,UAAU,EAAE;YAC/CN,IAAI,CAACM,YAAY,CAAC,IAAI,GAAGL,KAAK,EAAEL,EAAE,CAAC;UACrC;QACF;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAASf,uBAAuB,CAAC0B,KAAK,EAAEC,KAAK,EAAE;UAC7C,IAAIzB,GAAG,GAAG0B,IAAI,CAACC,GAAG,CAACH,KAAK,CAACxB,GAAG,EAAEyB,KAAK,CAACzB,GAAG,CAAC;UACxC,IAAII,MAAM,GAAGsB,IAAI,CAACE,GAAG,CAACJ,KAAK,CAACpB,MAAM,EAAEqB,KAAK,CAACrB,MAAM,CAAC;UACjD,IAAIH,IAAI,GAAGyB,IAAI,CAACC,GAAG,CAACH,KAAK,CAACvB,IAAI,EAAEwB,KAAK,CAACxB,IAAI,CAAC;UAC3C,IAAIC,KAAK,GAAGwB,IAAI,CAACE,GAAG,CAACJ,KAAK,CAACtB,KAAK,EAAEuB,KAAK,CAACvB,KAAK,CAAC;UAC9C,IAAIjH,KAAK,GAAGiH,KAAK,GAAGD,IAAI;UACxB,IAAI/G,MAAM,GAAGkH,MAAM,GAAGJ,GAAG;UAEzB,OAAQ/G,KAAK,IAAI,CAAC,IAAIC,MAAM,IAAI,CAAC,IAAK;YACpC8G,GAAG,EAAEA,GAAG;YACRI,MAAM,EAAEA,MAAM;YACdH,IAAI,EAAEA,IAAI;YACVC,KAAK,EAAEA,KAAK;YACZjH,KAAK,EAAEA,KAAK;YACZC,MAAM,EAAEA;UACV,CAAC,IAAI,IAAI;QACX;;QAGA;AACA;AACA;AACA;AACA;QACA,SAASwF,qBAAqB,CAACmD,EAAE,EAAE;UACjC,IAAItB,IAAI;UAER,IAAI;YACFA,IAAI,GAAGsB,EAAE,CAACnD,qBAAqB,EAAE;UACnC,CAAC,CAAC,OAAOrK,GAAG,EAAE;YACZ;YACA;UAAA;UAGF,IAAI,CAACkM,IAAI,EAAE,OAAO1H,YAAY,EAAE;;UAEhC;UACA,IAAI,EAAE0H,IAAI,CAACtH,KAAK,IAAIsH,IAAI,CAACrH,MAAM,CAAC,EAAE;YAChCqH,IAAI,GAAG;cACLP,GAAG,EAAEO,IAAI,CAACP,GAAG;cACbE,KAAK,EAAEK,IAAI,CAACL,KAAK;cACjBE,MAAM,EAAEG,IAAI,CAACH,MAAM;cACnBH,IAAI,EAAEM,IAAI,CAACN,IAAI;cACfhH,KAAK,EAAEsH,IAAI,CAACL,KAAK,GAAGK,IAAI,CAACN,IAAI;cAC7B/G,MAAM,EAAEqH,IAAI,CAACH,MAAM,GAAGG,IAAI,CAACP;YAC7B,CAAC;UACH;UACA,OAAOO,IAAI;QACb;;QAGA;AACA;AACA;AACA;AACA;QACA,SAAS1H,YAAY,GAAG;UACtB,OAAO;YACLmH,GAAG,EAAE,CAAC;YACNI,MAAM,EAAE,CAAC;YACTH,IAAI,EAAE,CAAC;YACPC,KAAK,EAAE,CAAC;YACRjH,KAAK,EAAE,CAAC;YACRC,MAAM,EAAE;UACV,CAAC;QACH;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAASR,aAAa,CAAC6H,IAAI,EAAE;UAC3B;UACA,IAAI,CAACA,IAAI,IAAI,GAAG,IAAIA,IAAI,EAAE;YACxB,OAAOA,IAAI;UACb;UACA;UACA;UACA;UACA;UACA,OAAO;YACLP,GAAG,EAAEO,IAAI,CAACP,GAAG;YACb8B,CAAC,EAAEvB,IAAI,CAACP,GAAG;YACXI,MAAM,EAAEG,IAAI,CAACH,MAAM;YACnBH,IAAI,EAAEM,IAAI,CAACN,IAAI;YACf8B,CAAC,EAAExB,IAAI,CAACN,IAAI;YACZC,KAAK,EAAEK,IAAI,CAACL,KAAK;YACjBjH,KAAK,EAAEsH,IAAI,CAACtH,KAAK;YACjBC,MAAM,EAAEqH,IAAI,CAACrH;UACf,CAAC;QACH;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAASgC,qBAAqB,CAAC8G,kBAAkB,EAAEC,sBAAsB,EAAE;UACzE,IAAIjC,GAAG,GAAGiC,sBAAsB,CAACjC,GAAG,GAAGgC,kBAAkB,CAAChC,GAAG;UAC7D,IAAIC,IAAI,GAAGgC,sBAAsB,CAAChC,IAAI,GAAG+B,kBAAkB,CAAC/B,IAAI;UAChE,OAAO;YACLD,GAAG,EAAEA,GAAG;YACRC,IAAI,EAAEA,IAAI;YACV/G,MAAM,EAAE+I,sBAAsB,CAAC/I,MAAM;YACrCD,KAAK,EAAEgJ,sBAAsB,CAAChJ,KAAK;YACnCmH,MAAM,EAAEJ,GAAG,GAAGiC,sBAAsB,CAAC/I,MAAM;YAC3CgH,KAAK,EAAED,IAAI,GAAGgC,sBAAsB,CAAChJ;UACvC,CAAC;QACH;;QAGA;AACA;AACA;AACA;AACA;AACA;AACA;QACA,SAAS0H,YAAY,CAACvB,MAAM,EAAE8C,KAAK,EAAE;UACnC,IAAIjB,IAAI,GAAGiB,KAAK;UAChB,OAAOjB,IAAI,EAAE;YACX,IAAIA,IAAI,IAAI7B,MAAM,EAAE,OAAO,IAAI;YAE/B6B,IAAI,GAAG5B,aAAa,CAAC4B,IAAI,CAAC;UAC5B;UACA,OAAO,KAAK;QACd;;QAGA;AACA;AACA;AACA;AACA;AACA;QACA,SAAS5B,aAAa,CAAC4B,IAAI,EAAE;UAC3B,IAAI7B,MAAM,GAAG6B,IAAI,CAACkB,UAAU;UAE5B,IAAIlB,IAAI,CAACrH,QAAQ,IAAI,cAAe,CAAC,IAAIqH,IAAI,IAAIjJ,QAAQ,EAAE;YACzD;YACA,OAAOL,eAAe,CAACsJ,IAAI,CAAC;UAC9B;UAEA,IAAI7B,MAAM,IAAIA,MAAM,CAACxF,QAAQ,IAAI,EAAE,IAAIwF,MAAM,CAACgD,IAAI,EAAE;YAClD;YACA,OAAOhD,MAAM,CAACgD,IAAI;UACpB;UAEA,IAAIhD,MAAM,IAAIA,MAAM,CAACiD,YAAY,EAAE;YACjC;YACA,OAAOjD,MAAM,CAACiD,YAAY,CAACF,UAAU;UACvC;UAEA,OAAO/C,MAAM;QACf;;QAGA;QACAhI,MAAM,CAACkC,oBAAoB,GAAGA,oBAAoB;QAClDlC,MAAM,CAACC,yBAAyB,GAAGA,yBAAyB;MAE5D,CAAC,GAAE;;;;;;;;;;;;;;MCz9BH;MAAe;MAAA,ibAAgZ;;;;;;;;;;;;;;MCA/Z;MAAe;MAAA,oiBAAmgB;;;;;;;;;;;;;;MCElhB;MAAA;MAAA;QAAA;MAAA;MAAA;MAAA;QAAA;MAAA;MAAA,IAAYiL,eAIX;MAJD,WAAYA,eAAe;QACzB,gCAAa;QACb,gCAAa;QACb,gCAAa;MACf,CAAC,EAJWA,eAAe,KAAfA,eAAe;MAM3B,IAAYC,oBAGX;MAHD,WAAYA,oBAAoB;QAC9B,yCAAiB;QACjB,yCAAiB;MACnB,CAAC,EAHWA,oBAAoB,KAApBA,oBAAoB;;;;;;;;;;;;;;MCRhC;MAAe;MAAA,kzEAAixE;;;;;;;;;;;;;;MCAhyE;MAAA;MAAA;QAAA;MAAA;MAAA;MAAA;MAAA;MAAA;;MAGA;;;;;;MAAA,IAMaC,SAAS;QACpB;;;QAGA,mBAAY/G,OAAqB,EAAE;UAAA;UASnC;;;;UAIA,KAAA5E,MAAM,GAAyB,IAAI,4CAAO,EAAe;UAOzD;;;UAGA,KAAAvB,QAAQ,GAAY,IAAI;UAtBtB,IAAI,CAACmG,OAAO,GAAGA,OAAO;QACxB;QAuBA;;;;QAAA;UAAA;UAAA,OAIA,cAAKhG,KAAwB,EAAE;YAC7B,IAAI,CAACA,KAAK,GAAGA,KAAK;UACpB;UAEA;;;;;QAAA;UAAA;UAAA,OAKA,kBAAS3B,IAAY,EAAEuB,KAAiC,EAAE;YACxD,IAAI,CAACwB,MAAM,CAAC4L,IAAI,CACd,IAAI,yDAAW,CAAC3O,IAAI,EAAE;cACpBC,KAAK,EAAE,IAAI;cACXsB,KAAK,EAALA;aACD,CAAC,CACH;UACH;UAEA;;;;QAAA;UAAA;UAAA,OAIA,gBAAOA,KAAiC;YACtC,IAAI,IAAI,CAACC,QAAQ,KAAK,IAAI,EAAE;YAC5B,IAAI,CAACA,QAAQ,GAAG,IAAI;YACpB,IAAI,CAACC,QAAQ,CAAC,yDAAW,CAACC,MAAM,EAAEH,KAAK,CAAC;UAC1C;UAEA;;;;QAAA;UAAA;UAAA,OAIA,mBAAUA,KAAiC;YACzC,IAAI,IAAI,CAACC,QAAQ,KAAK,KAAK,EAAE;YAC7B,IAAI,CAACA,QAAQ,GAAG,KAAK;YACrB,IAAI,CAACC,QAAQ,CAAC,yDAAW,CAACO,SAAS,EAAET,KAAK,CAAC;UAC7C;UAEA;;;QAAA;UAAA;UAAA,OAGA,mBAAU;YACR,IAAI,IAAI,CAACI,KAAK,EAAE;cACd,IAAI,CAACA,KAAK,CAACtB,SAAS,CAAC,IAAI,CAAC;;UAE9B;QAAC;QAAA;MAAA;;;;;;;;;;;;MCvFH;MAAe;MAAA,ibAAgZ;;;;;;;;;;;;;;MCA/Z;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;MAAA;QAAA;MAAA;;MAAA;MAAA;MAAA;MAAA;QAAA;MAAA;;MAAA;MAAA;MAAA;MAAA;QAAA;MAAA;;MAAA;MAAA;MAAA;MAAA;QAAA;MAAA;;MAAA;MAAA;MAAA;MAAA;QAAA;MAAA;;MAAA;MAAA;QAAA;MAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;UCSauO,mBAAmB;QAAA;MAAA,EAAG;MAAtBA,mBAAmB,6DAL/B,8DAAQ,CAAC;QACR/N,OAAO,EAAE,CAAC,4DAAY,CAAC;QACvBQ,OAAO,EAAE,CAAC,wHAAoB,CAAC;QAC/BP,YAAY,EAAE,CAAC,wHAAoB;OACpC,CAAC,C,EACW8N,mBAAmB,CAAG;;;;;;;;;;;;;;MCTnC;MAAA;MAAA;QAAA;MAAA;MAAA;MAAA;MAAA;MAAA;;MAGA;;;;;;;MAAA,IAOaC,SAAU;QAAA;QAAA;QAAvB;UAAA;UAAA;;UACU,MAAAC,WAAW,GAAQ,IAAI;UACvB,MAAAC,aAAa,GAAW,IAAI;UAC5B,MAAAC,WAAW,GAAW,GAAG;UAAC;QAsEpC;QApEE;;;;;QAAA;UAAA;UAAA,OAKA,4BAAuC;YAAA,IAAtBC,KAAK,uEAAW,IAAI;YACnC,IAAI,CAACF,aAAa,GAAGE,KAAK;UAC5B;UAEA;;;;QAAA;UAAA;UAAA,OAIA,0BAAoC;YAAA,IAArBA,KAAK,uEAAW,GAAG;YAChC,IAAI,CAACD,WAAW,GAAGC,KAAK;UAC1B;UAEA;;;QAAA;UAAA;UAAA,OAGQ,4BAAmB;YACzB,IAAI,IAAI,CAACH,WAAW,EAAE;cACpBI,YAAY,CAAC,IAAI,CAACJ,WAAW,CAAC;cAC9B,IAAI,CAACA,WAAW,GAAG,IAAI;;UAE3B;UAEA;;;;;QAAA;UAAA;UAAA,OAKA,gBAAOvN,KAAgC,EAAE;YAAA;YACvC,IAAI,CAAC4N,gBAAgB,EAAE;YACvB,IAAI,IAAI,CAAC3N,QAAQ,KAAK,IAAI,EAAE;YAC5B,IAAI,IAAI,CAACuN,aAAa,IAAIxN,KAAK,CAACkD,IAAI,EAAE;cACpC,IAAI,CAACqK,WAAW,GAAG5B,UAAU,CAAC,YAAM;gBAClC,MAAI,CAACkC,QAAQ,CAAC7N,KAAK,CAAC;cACtB,CAAC,EAAE,IAAI,CAACyN,WAAW,CAAC;aACrB,MAAM;cACL,IAAI,CAACI,QAAQ,CAAC7N,KAAK,CAAC;;UAExB;UAEA;;;;;QAAA;UAAA;UAAA,OAKQ,kBAASA,KAAgC,EAAE;YACjD,IAAI,CAACC,QAAQ,GAAG,IAAI;YACpB,IAAI,CAACC,QAAQ,CAAC,yDAAW,CAACC,MAAM,EAAEH,KAAK,CAAC;YACxC,IAAI,IAAI,CAACI,KAAK,EAAE;cACd,IAAI,CAACA,KAAK,CAACtB,SAAS,CAAC,IAAI,CAAC;;UAE9B;UAEA;;;;;QAAA;UAAA;UAAA,OAKA,mBAAUkB,KAAgC,EAAE;YAC1C,IAAI,CAAC4N,gBAAgB,EAAE;YACvB,IAAI,CAAC,IAAI,CAAC3N,QAAQ,EAAE;YACpB,IAAI,CAACA,QAAQ,GAAG,KAAK;YACrB,IAAI,CAACC,QAAQ,CAAC,yDAAW,CAACO,SAAS,EAAET,KAAK,CAAC;UAC7C;QAAC;QAAA;MAAA,EAxE4B,qDAAS;;;;;;;;;;;;MCRxC;MAAA;MAAA;QAAA;MAAA;MAAA;;;;;MAAA,IAKa8N,WAAW;QAAA;UAAA;QAAA;QAAA;UAAA;UAAA;UAYtB;;;;UAIA,gBAA6B;YAAA,IAAxBtN,MAAM,uEAAgB,CAAC,CAAC;YAC3B,IAAI,CAAC,IAAI,CAACuF,QAAQ,EAAE;cAClB,IAAI,CAACgI,QAAQ,GAAG,IAAIC,GAAG,EAAmB;cAC1C,IAAI,CAACjI,QAAQ,GAAG,IAAI9B,oBAAoB,CACtC,IAAI,CAACgK,gBAAgB,CAACtM,IAAI,CAAC,IAAI,CAAC,EAChCnB,MAAM,CACP;;UAEL;UAEA;;;;QAAA;UAAA;UAAA,OAIA,iBAAQ9B,KAAQ;YACd,IAAQ0H,OAAO,GAAK1H,KAAK,CAAjB0H,OAAO;YACf,IAAI,IAAI,CAAC2H,QAAQ,IAAI,CAAC,IAAI,CAACA,QAAQ,CAACG,GAAG,CAAC9H,OAAO,CAAC,EAAE;cAChD1H,KAAK,CAACiD,IAAI,CAAC,IAAI,CAAC;cAChB,IAAI,CAACoM,QAAQ,CAACI,GAAG,CAAC/H,OAAO,EAAE1H,KAAK,CAAC;cACjC,IAAI,CAAC0P,oBAAoB,CAACxP,OAAO,CAACwH,OAAO,CAAC;;UAE9C;UAEA;;;;QAAA;UAAA;UAAA,OAIA,mBAAU1H,KAAQ;YAChB,IAAQ0H,OAAO,GAAK1H,KAAK,CAAjB0H,OAAO;YACf,IAAI,IAAI,CAAC2H,QAAQ,IAAI,IAAI,CAACA,QAAQ,CAACG,GAAG,CAAC9H,OAAO,CAAC,EAAE;cAC/C,IAAI,CAAC2H,QAAQ,UAAO,CAAC3H,OAAO,CAAC;cAC7B,IAAI,CAACgI,oBAAoB,CAACtP,SAAS,CAACsH,OAAO,CAAC;;UAEhD;UAEA;;;QAAA;UAAA;UAAA,KAGA,eAAgB;YACd,OAAO,IAAI,CAAC2H,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACM,IAAI,GAAG,CAAC;UAC/C;UAEA;;;;QAAA;UAAA;UAAA,OAIA,qBAAS;YACP,OAAOrQ,KAAK,CAACC,IAAI,CAAC,IAAI,CAAC8P,QAAQ,GAAG,IAAI,CAACA,QAAQ,CAACO,MAAM,EAAE,GAAG,EAAE,CAAC;UAChE;UAEA;;;QAAA;UAAA;UAAA,KAGA,eAAwB;YACtB,IAAI,CAAC,IAAI,CAACvI,QAAQ,EAAE,MAAM,IAAI1B,KAAK,CAAC,cAAc,CAAC;YACnD,OAAO,IAAI,CAAC0B,QAAQ;UACtB;UAEA;;;;QAAA;UAAA;UAAA,OAIU,0BAAiBwI,OAAoC,EAAE;YAAA;YAC/DA,OAAO,CAACzI,OAAO,CAAC,UAAC9F,KAAgC,EAAK;cACpD,IAAI,CAAC,MAAI,CAAC+N,QAAQ,EAAE;cACpB,IAAQtK,cAAc,GAAazD,KAAK,CAAhCyD,cAAc;gBAAEN,MAAM,GAAKnD,KAAK,CAAhBmD,MAAM;cAC9B,IAAMzE,KAAK,GAAG,MAAI,CAACqP,QAAQ,CAAC3L,GAAG,CAACe,MAAM,CAAC;cACvC,IAAIzE,KAAK,EAAE;gBACT,IAAI+E,cAAc,EAAE;kBAClB/E,KAAK,CAAC8P,MAAM,CAACxO,KAAK,CAAC;iBACpB,MAAM;kBACLtB,KAAK,CAAC+P,SAAS,CAACzO,KAAK,CAAC;;;YAG5B,CAAC,CAAC;UACJ;UAEA;;;QAAA;UAAA;UAAA,OAGA,mBAAO;YACL,IAAI,IAAI,CAAC+F,QAAQ,EAAE;cACjB,IAAI,CAACA,QAAQ,CAACa,UAAU,EAAE;cAC1B,IAAI,CAACb,QAAQ,GAAG,IAAI;;YAEtB,IAAI,IAAI,CAACgI,QAAQ,EAAE;cACjB,IAAI,CAACA,QAAQ,CAACW,KAAK,EAAE;cACrB,IAAI,CAACX,QAAQ,GAAG,IAAI;;UAExB;QAAC;QAAA;MAAA;;;;;;;;;;;;MChHH;MAAe;MAAA,ibAAgZ","file":"dev-app-pages-demo-demo-module-es5.js","sourcesContent":["import { Component, OnInit } from \"@angular/core\";\nimport { AppearStage } from \"projects/packages/src/public-api\";\nimport {\n  SampleActorEvent,\n  SampleActorEventType,\n} from \"~/dev/app/modules/example/common/sample-actor/types\";\n\n@Component({\n  selector: \"example-lazy-actor\",\n  templateUrl: \"./lazy-actor.component.html\",\n  styleUrls: [\"./lazy-actor.component.scss\"],\n})\nexport class LazyActorComponent implements OnInit {\n  constructor() {}\n\n  actorMakeList: any[];\n  appearStage: AppearStage;\n\n  ngOnInit() {\n    this.actorMakeList = Array.from(Array(50)).map((a, b) => {\n      return { id: b };\n    });\n    this.appearStage = new AppearStage();\n    this.appearStage.init();\n  }\n\n  onSampleAppearEvent(evt: SampleActorEvent) {\n    const { type, actor } = evt;\n    switch (type) {\n      case SampleActorEventType.ATTACH:\n        this.appearStage.observe(actor);\n        break;\n      case SampleActorEventType.DETACH:\n        this.appearStage.unobserve(actor);\n        break;\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      if (this.appearStage) {\n        this.appearStage.dispose();\n        this.appearStage = null;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n}\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { RoutingModule } from \"~/dev/app/pages/demo/demo.routing\";\nimport { SharedModule } from \"~/dev/app/shared/shared.module\";\nimport { ExampleCommonModule } from \"~/dev/app/modules/example/common/common.module\";\nimport { BaseActorComponent } from \"./base-actor/base-actor.component\";\nimport { OnceActorComponent } from \"./once-actor/once-actor.component\";\nimport { LazyActorComponent } from \"./lazy-actor/lazy-actor.component\";\n\n@NgModule({\n  imports: [CommonModule, RoutingModule, SharedModule, ExampleCommonModule],\n  declarations: [BaseActorComponent, OnceActorComponent, LazyActorComponent],\n})\nexport class PageModule {}\n","export default \"<div class=\\\"horizontal-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    [item]=\\\"item\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\\n<div class=\\\"vertical-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    [item]=\\\"item\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\";","import { NgModule } from \"@angular/core\";\nimport { Routes, RouterModule } from \"@angular/router\";\nimport { BaseActorComponent } from \"./base-actor/base-actor.component\";\nimport { OnceActorComponent } from \"./once-actor/once-actor.component\";\nimport { LazyActorComponent } from \"./lazy-actor/lazy-actor.component\";\n\nconst routes: Routes = [\n  {\n    path: \"\",\n    children: [\n      {\n        path: \"base-actor\",\n        component: BaseActorComponent,\n      },\n      {\n        path: \"once-actor\",\n        component: OnceActorComponent,\n      },\n      {\n        path: \"lazy-actor\",\n        component: LazyActorComponent,\n      },\n      {\n        path: \"**\",\n        component: BaseActorComponent,\n      },\n    ],\n  },\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class RoutingModule {}\n","import { BaseActor } from './base-actor';\nimport { AppearEvent, IOnceActor } from '../common/types';\n\n/**\n * Stage 에 등록될 Actor.\n * 스테이지 진입을 한번만 감지한 후 본인 스스로 관찰 해제하는 감지형.\n * (사용 예: 화면 진입시 한번만 애니메이션 한다, 이미지 로드를 한다)\n * @class OnceActor\n * @extends {BaseActor}\n */\nexport class OnceActor extends BaseActor implements IOnceActor {\n  /**\n   * 스테이지 진입. 진입시 자동 관찰 해제.\n   * @override\n   * @param [entry]\n   */\n  appear(entry?: IntersectionObserverEntry): void {\n    if (this.isAppear === true) return;\n    this.isAppear = true;\n    this.dispatch(AppearEvent.APPEAR, entry);\n    if (this.stage) {\n      this.stage.unobserve(this);\n    }\n  }\n}\n","export default \".horizontal-list {\\n  display: flex;\\n  flex-wrap: nowrap;\\n  overflow-x: auto;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xhenktYWN0b3IuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFBO0VBQ0EsaUJBQUE7RUFDQSxnQkFBQTtBQUNGIiwiZmlsZSI6ImxhenktYWN0b3IuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuaG9yaXpvbnRhbC1saXN0IHtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC13cmFwOiBub3dyYXA7XG4gIG92ZXJmbG93LXg6IGF1dG87XG59XG4iXX0= */\";","import { Component, OnInit } from \"@angular/core\";\nimport { AppearStage } from \"projects/packages/src/public-api\";\nimport {\n  SampleActorEvent,\n  SampleActorEventType,\n} from \"~/dev/app/modules/example/common/sample-actor/types\";\n\n@Component({\n  selector: \"example-once-actor\",\n  templateUrl: \"./once-actor.component.html\",\n  styleUrls: [\"./once-actor.component.scss\"],\n})\nexport class OnceActorComponent implements OnInit {\n  constructor() {}\n\n  actorMakeList: any[];\n  appearStage: AppearStage;\n\n  ngOnInit() {\n    this.actorMakeList = Array.from(Array(50)).map((a, b) => {\n      return { id: b };\n    });\n    this.appearStage = new AppearStage();\n    this.appearStage.init();\n  }\n\n  onSampleAppearEvent(evt: SampleActorEvent) {\n    const { type, actor } = evt;\n    switch (type) {\n      case SampleActorEventType.ATTACH:\n        this.appearStage.observe(actor);\n        break;\n      case SampleActorEventType.DETACH:\n        this.appearStage.unobserve(actor);\n        break;\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      if (this.appearStage) {\n        this.appearStage.dispose();\n        this.appearStage = null;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n}\n","import { Subject } from \"rxjs\";\n\n/**\n * Actor type 구분\n * @export\n * @enum {number}\n */\nexport enum AppearType {\n  BASE = \"base\",\n  ONCE = \"once\",\n  LAZY = \"lazy\"\n}\n\n/**\n * 관찰자\n * @interface IStage\n * @template T\n * @property init {method} 초기화\n * @property observe {method} 관찰 대상 등록\n * @property unobserve {method} 관찰 대상 해제\n * @property dispose {method} 파기\n */\nexport interface IStage<T> {\n  /**\n   * @param [option] 초기 옵션\n   */\n  init(option?: StageOption): void;\n\n  /**\n   * @param actor 관찰대상\n   */\n  observe(actor: T): void;\n\n  /**\n   * @param actor 관찰해제 대상\n   */\n  unobserve(actor: T): void;\n\n  /**\n   * 파기\n   */\n  dispose(): void;\n}\n\n/**\n * 관찰대상\n * @interface IActor\n * @property element {ActorElement} 관찰 대상이 참조해야하는 DOM\n * @property stage {IStage<any>} 관찰 대상이 속하게 되는 스테이지(관찰자)\n * @property events {Subject<AppearEvent>} 관찰 이벤트 Observable\n * @property isAppear {boolean} 현재 관찰대상의 진입, 이탈 여부\n * @property bind {method} 관찰 대상이 속하게 되는 스테이지(관찰자) 등록.\n * @property appear {method} 스테이지 진입.\n * @property disappear {method} 스테이지 이탈.\n * @property dispose {method} 파기\n */\nexport interface IActor {\n  element: ActorElement;\n  stage: IStage<any>;\n  events: Subject<AppearEvent>;\n  isAppear: boolean;\n\n  /**\n   * @param stage 관찰 대상으로 등록될 때 해당 인스턴스를 관찰하는 스테이지\n   */\n  bind(stage: IStage<IActor>): void;\n\n  /**\n   * @param [entry] 진입 당시 관찰 정보\n   */\n  appear(entry?: IntersectionObserverEntry): void;\n\n  /**\n   * @param [entry] 이탈 당시 관찰 정보\n   */\n  disappear(entry?: IntersectionObserverEntry): void;\n\n  dispose(): void;\n}\n\n/**\n * 관찰대상 - 한번만 형\n * @export\n * @interface IOnceActor\n */\nexport interface IOnceActor {}\n\n/**\n * 관찰대상 - 한번만 느긋하게 형\n * @export\n * @interface ILazyActor\n * @property setCheckoutDelay {method} 느린 감지를 시작하기 전 대기 시간.\n * @property setAppearDelay {method} 지정된 시간 사이에 진입 후 진출을 하는 경우 진입 알림을 하지 않는 대기 시간.\n */\nexport interface ILazyActor {\n  setCheckoutDelay?(delay: number): void;\n  setAppearDelay?(delay: number): void;\n}\n\nexport interface Actor extends IActor, IOnceActor, ILazyActor {}\n\n/**\n * 관찰자, 관찰대상에서 참조되어야 하는 native element 타입\n * @typedef {HTMLElement | Element} ActorElement\n */\nexport type ActorElement = HTMLElement | Element;\n\n/**\n * 스테이지 초기 옵션.\n * @interface StageOption\n * @property root {Element} mdn 참고\n * @property rootMargin {string} mdn 참고\n * @property threshold {string | array} mdn 참고\n * @extends {IntersectionObserverInit}\n * @see https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n */\nexport interface StageOption extends IntersectionObserverInit {}\n\n/**\n * 관찰대상의 이벤트\n * @implements {AppearEventData<T>}\n * @template T\n */\nexport class AppearEvent<T = IActor> implements AppearEventData<T> {\n  /**\n   * @param type 이벤트 타입\n   * @param option 이벤트 데이터\n   */\n  constructor(type: string, option: AppearEventData<T>) {\n    const { actor, entry } = option;\n    this.type = type;\n    this.actor = actor;\n    this.entry = entry;\n  }\n\n  /**\n   * 이벤트 타입 - 진입\n   */\n  static readonly APPEAR: string = \"APPEAR\";\n\n  /**\n   * 이벤트 타입 - 이탈\n   */\n  static readonly DISAPPEAR: string = \"DISAPPEAR\";\n\n  /**\n   * 이벤트 타입\n   */\n  type: string;\n\n  /**\n   * 참조되는 관찰대상\n   */\n  actor: T;\n\n  /**\n   * 인터섹션 옵저버의 진입, 이탈 당시 관찰 상태\n   */\n  entry: IntersectionObserverEntry;\n}\n\n/**\n * Appear 이벤트의 데이터\n * @interface AppearEventData\n * @property actor {T} 참조되는 관찰대상\n * @property entry {IntersectionObserverEntry} 인터섹션 옵저버의 진입, 이탈 당시 관찰 상태\n * @template T\n */\nexport interface AppearEventData<T> {\n  actor: T;\n  entry: IntersectionObserverEntry;\n}\n","import { Component, OnInit } from \"@angular/core\";\nimport { AppearStage } from \"projects/packages/src/public-api\";\nimport {\n  SampleActorEvent,\n  SampleActorEventType,\n} from \"~/dev/app/modules/example/common/sample-actor/types\";\n\n@Component({\n  selector: \"example-base-actor\",\n  templateUrl: \"./base-actor.component.html\",\n  styleUrls: [\"./base-actor.component.scss\"],\n})\nexport class BaseActorComponent implements OnInit {\n  constructor() {}\n\n  actorMakeList: any[] = [];\n  appearStage: AppearStage;\n\n  ngOnInit() {\n    this.actorMakeList = Array.from(Array(50)).map((a, b) => {\n      return { id: b };\n    });\n    this.appearStage = new AppearStage();\n    this.appearStage.init();\n  }\n\n  onSampleAppearEvent(evt: SampleActorEvent) {\n    const { type, actor } = evt;\n    switch (type) {\n      case SampleActorEventType.ATTACH:\n        this.appearStage.observe(actor);\n        break;\n      case SampleActorEventType.DETACH:\n        this.appearStage.unobserve(actor);\n        break;\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      if (this.appearStage) {\n        this.appearStage.dispose();\n        this.appearStage = null;\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n}\n","import { Subscription } from \"rxjs\";\nimport {\n  Component,\n  OnInit,\n  ElementRef,\n  Input,\n  Output,\n  EventEmitter,\n  HostBinding,\n} from \"@angular/core\";\nimport {\n  Actor,\n  OnceActor,\n  LazyActor,\n  BaseActor,\n  AppearEvent,\n} from \"projects/packages/src/public-api\";\nimport {\n  SampleActorType,\n  SampleActorEvent,\n  SampleActorEventType,\n} from \"~/dev/app/modules/example/common/sample-actor/types\";\n\n@Component({\n  selector: \"sample-actor\",\n  templateUrl: \"./sample-actor.component.html\",\n  styleUrls: [\"./sample-actor.component.scss\"],\n})\nexport class SampleActorComponent implements OnInit {\n  constructor(private elRef: ElementRef) {\n    this.appearerListener = new Subscription();\n  }\n\n  actor: Actor;\n  appearerListener: Subscription;\n\n  @Input()\n  item: any;\n\n  @Input()\n  actorType: SampleActorType;\n\n  @Output(\"sampleEvent\")\n  emitter: EventEmitter<SampleActorEvent> = new EventEmitter();\n\n  @HostBinding(\"class.is-appeared\")\n  get isAppeared() {\n    return !!(this.actor && this.actor.isAppear);\n  }\n\n  ngOnInit() {\n    const { nativeElement } = this.elRef;\n    switch (this.actorType) {\n      case SampleActorType.ONCE:\n        this.actor = new OnceActor(nativeElement);\n        break;\n      case SampleActorType.LAZY:\n        this.actor = new LazyActor(nativeElement);\n        this.actor.setCheckoutDelay(1000);\n        this.actor.setAppearDelay(200);\n        break;\n      default:\n        this.actor = new BaseActor(nativeElement);\n        break;\n    }\n\n    const observeAppearEvent = this.actor.events.subscribe(\n      this.onAppearEvent.bind(this)\n    );\n    this.appearerListener.add(observeAppearEvent);\n    this.emitter.emit({\n      type: SampleActorEventType.ATTACH,\n      actor: this.actor,\n    });\n  }\n\n  appearCount: number = 0;\n  disappearCount: number = 0;\n\n  onAppearEvent(evt: AppearEvent) {\n    switch (evt.type) {\n      case AppearEvent.APPEAR:\n        this.appearCount++;\n        break;\n      case AppearEvent.DISAPPEAR:\n        this.disappearCount++;\n        break;\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      this.emitter.emit({\n        type: SampleActorEventType.DETACH,\n        actor: this.actor,\n      });\n      if (this.appearerListener) {\n        this.appearerListener.unsubscribe();\n      }\n    } catch (err) {\n      console.log(err);\n    }\n  }\n}\n","export default \".horizontal-list {\\n  display: flex;\\n  flex-wrap: nowrap;\\n  overflow-x: auto;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2Jhc2UtYWN0b3IuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFBO0VBQ0EsaUJBQUE7RUFDQSxnQkFBQTtBQUNGIiwiZmlsZSI6ImJhc2UtYWN0b3IuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuaG9yaXpvbnRhbC1saXN0IHtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC13cmFwOiBub3dyYXA7XG4gIG92ZXJmbG93LXg6IGF1dG87XG59XG4iXX0= */\";","/**\n * Copyright 2016 Google Inc. All Rights Reserved.\n *\n * Licensed under the W3C SOFTWARE AND DOCUMENT NOTICE AND LICENSE.\n *\n *  https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document\n *\n */\n(function() {\n'use strict';\n\n// Exit early if we're not running in a browser.\nif (typeof window !== 'object') {\n  return;\n}\n\n// Exit early if all IntersectionObserver and IntersectionObserverEntry\n// features are natively supported.\nif ('IntersectionObserver' in window &&\n    'IntersectionObserverEntry' in window &&\n    'intersectionRatio' in window.IntersectionObserverEntry.prototype) {\n\n  // Minimal polyfill for Edge 15's lack of `isIntersecting`\n  // See: https://github.com/w3c/IntersectionObserver/issues/211\n  if (!('isIntersecting' in window.IntersectionObserverEntry.prototype)) {\n    Object.defineProperty(window.IntersectionObserverEntry.prototype,\n      'isIntersecting', {\n      get: function () {\n        return this.intersectionRatio > 0;\n      }\n    });\n  }\n  return;\n}\n\n/**\n * Returns the embedding frame element, if any.\n * @param {!Document} doc\n * @return {!Element}\n */\nfunction getFrameElement(doc) {\n  try {\n    return doc.defaultView && doc.defaultView.frameElement || null;\n  } catch (e) {\n    // Ignore the error.\n    return null;\n  }\n}\n\n/**\n * A local reference to the root document.\n */\nvar document = (function(startDoc) {\n  var doc = startDoc;\n  var frame = getFrameElement(doc);\n  while (frame) {\n    doc = frame.ownerDocument;\n    frame = getFrameElement(doc);\n  }\n  return doc;\n})(window.document);\n\n/**\n * An IntersectionObserver registry. This registry exists to hold a strong\n * reference to IntersectionObserver instances currently observing a target\n * element. Without this registry, instances without another reference may be\n * garbage collected.\n */\nvar registry = [];\n\n/**\n * The signal updater for cross-origin intersection. When not null, it means\n * that the polyfill is configured to work in a cross-origin mode.\n * @type {function(DOMRect|ClientRect, DOMRect|ClientRect)}\n */\nvar crossOriginUpdater = null;\n\n/**\n * The current cross-origin intersection. Only used in the cross-origin mode.\n * @type {DOMRect|ClientRect}\n */\nvar crossOriginRect = null;\n\n\n/**\n * Creates the global IntersectionObserverEntry constructor.\n * https://w3c.github.io/IntersectionObserver/#intersection-observer-entry\n * @param {Object} entry A dictionary of instance properties.\n * @constructor\n */\nfunction IntersectionObserverEntry(entry) {\n  this.time = entry.time;\n  this.target = entry.target;\n  this.rootBounds = ensureDOMRect(entry.rootBounds);\n  this.boundingClientRect = ensureDOMRect(entry.boundingClientRect);\n  this.intersectionRect = ensureDOMRect(entry.intersectionRect || getEmptyRect());\n  this.isIntersecting = !!entry.intersectionRect;\n\n  // Calculates the intersection ratio.\n  var targetRect = this.boundingClientRect;\n  var targetArea = targetRect.width * targetRect.height;\n  var intersectionRect = this.intersectionRect;\n  var intersectionArea = intersectionRect.width * intersectionRect.height;\n\n  // Sets intersection ratio.\n  if (targetArea) {\n    // Round the intersection ratio to avoid floating point math issues:\n    // https://github.com/w3c/IntersectionObserver/issues/324\n    this.intersectionRatio = Number((intersectionArea / targetArea).toFixed(4));\n  } else {\n    // If area is zero and is intersecting, sets to 1, otherwise to 0\n    this.intersectionRatio = this.isIntersecting ? 1 : 0;\n  }\n}\n\n\n/**\n * Creates the global IntersectionObserver constructor.\n * https://w3c.github.io/IntersectionObserver/#intersection-observer-interface\n * @param {Function} callback The function to be invoked after intersection\n *     changes have queued. The function is not invoked if the queue has\n *     been emptied by calling the `takeRecords` method.\n * @param {Object=} opt_options Optional configuration options.\n * @constructor\n */\nfunction IntersectionObserver(callback, opt_options) {\n\n  var options = opt_options || {};\n\n  if (typeof callback != 'function') {\n    throw new Error('callback must be a function');\n  }\n\n  if (options.root && options.root.nodeType != 1) {\n    throw new Error('root must be an Element');\n  }\n\n  // Binds and throttles `this._checkForIntersections`.\n  this._checkForIntersections = throttle(\n      this._checkForIntersections.bind(this), this.THROTTLE_TIMEOUT);\n\n  // Private properties.\n  this._callback = callback;\n  this._observationTargets = [];\n  this._queuedEntries = [];\n  this._rootMarginValues = this._parseRootMargin(options.rootMargin);\n\n  // Public properties.\n  this.thresholds = this._initThresholds(options.threshold);\n  this.root = options.root || null;\n  this.rootMargin = this._rootMarginValues.map(function(margin) {\n    return margin.value + margin.unit;\n  }).join(' ');\n\n  /** @private @const {!Array<!Document>} */\n  this._monitoringDocuments = [];\n  /** @private @const {!Array<function()>} */\n  this._monitoringUnsubscribes = [];\n}\n\n\n/**\n * The minimum interval within which the document will be checked for\n * intersection changes.\n */\nIntersectionObserver.prototype.THROTTLE_TIMEOUT = 100;\n\n\n/**\n * The frequency in which the polyfill polls for intersection changes.\n * this can be updated on a per instance basis and must be set prior to\n * calling `observe` on the first target.\n */\nIntersectionObserver.prototype.POLL_INTERVAL = null;\n\n/**\n * Use a mutation observer on the root element\n * to detect intersection changes.\n */\nIntersectionObserver.prototype.USE_MUTATION_OBSERVER = true;\n\n\n/**\n * Sets up the polyfill in the cross-origin mode. The result is the\n * updater function that accepts two arguments: `boundingClientRect` and\n * `intersectionRect` - just as these fields would be available to the\n * parent via `IntersectionObserverEntry`. This function should be called\n * each time the iframe receives intersection information from the parent\n * window, e.g. via messaging.\n * @return {function(DOMRect|ClientRect, DOMRect|ClientRect)}\n */\nIntersectionObserver._setupCrossOriginUpdater = function() {\n  if (!crossOriginUpdater) {\n    /**\n     * @param {DOMRect|ClientRect} boundingClientRect\n     * @param {DOMRect|ClientRect} intersectionRect\n     */\n    crossOriginUpdater = function(boundingClientRect, intersectionRect) {\n      if (!boundingClientRect || !intersectionRect) {\n        crossOriginRect = getEmptyRect();\n      } else {\n        crossOriginRect = convertFromParentRect(boundingClientRect, intersectionRect);\n      }\n      registry.forEach(function(observer) {\n        observer._checkForIntersections();\n      });\n    };\n  }\n  return crossOriginUpdater;\n};\n\n\n/**\n * Resets the cross-origin mode.\n */\nIntersectionObserver._resetCrossOriginUpdater = function() {\n  crossOriginUpdater = null;\n  crossOriginRect = null;\n};\n\n\n/**\n * Starts observing a target element for intersection changes based on\n * the thresholds values.\n * @param {Element} target The DOM element to observe.\n */\nIntersectionObserver.prototype.observe = function(target) {\n  var isTargetAlreadyObserved = this._observationTargets.some(function(item) {\n    return item.element == target;\n  });\n\n  if (isTargetAlreadyObserved) {\n    return;\n  }\n\n  if (!(target && target.nodeType == 1)) {\n    throw new Error('target must be an Element');\n  }\n\n  this._registerInstance();\n  this._observationTargets.push({element: target, entry: null});\n  this._monitorIntersections(target.ownerDocument);\n  this._checkForIntersections();\n};\n\n\n/**\n * Stops observing a target element for intersection changes.\n * @param {Element} target The DOM element to observe.\n */\nIntersectionObserver.prototype.unobserve = function(target) {\n  this._observationTargets =\n      this._observationTargets.filter(function(item) {\n        return item.element != target;\n      });\n  this._unmonitorIntersections(target.ownerDocument);\n  if (this._observationTargets.length == 0) {\n    this._unregisterInstance();\n  }\n};\n\n\n/**\n * Stops observing all target elements for intersection changes.\n */\nIntersectionObserver.prototype.disconnect = function() {\n  this._observationTargets = [];\n  this._unmonitorAllIntersections();\n  this._unregisterInstance();\n};\n\n\n/**\n * Returns any queue entries that have not yet been reported to the\n * callback and clears the queue. This can be used in conjunction with the\n * callback to obtain the absolute most up-to-date intersection information.\n * @return {Array} The currently queued entries.\n */\nIntersectionObserver.prototype.takeRecords = function() {\n  var records = this._queuedEntries.slice();\n  this._queuedEntries = [];\n  return records;\n};\n\n\n/**\n * Accepts the threshold value from the user configuration object and\n * returns a sorted array of unique threshold values. If a value is not\n * between 0 and 1 and error is thrown.\n * @private\n * @param {Array|number=} opt_threshold An optional threshold value or\n *     a list of threshold values, defaulting to [0].\n * @return {Array} A sorted list of unique and valid threshold values.\n */\nIntersectionObserver.prototype._initThresholds = function(opt_threshold) {\n  var threshold = opt_threshold || [0];\n  if (!Array.isArray(threshold)) threshold = [threshold];\n\n  return threshold.sort().filter(function(t, i, a) {\n    if (typeof t != 'number' || isNaN(t) || t < 0 || t > 1) {\n      throw new Error('threshold must be a number between 0 and 1 inclusively');\n    }\n    return t !== a[i - 1];\n  });\n};\n\n\n/**\n * Accepts the rootMargin value from the user configuration object\n * and returns an array of the four margin values as an object containing\n * the value and unit properties. If any of the values are not properly\n * formatted or use a unit other than px or %, and error is thrown.\n * @private\n * @param {string=} opt_rootMargin An optional rootMargin value,\n *     defaulting to '0px'.\n * @return {Array<Object>} An array of margin objects with the keys\n *     value and unit.\n */\nIntersectionObserver.prototype._parseRootMargin = function(opt_rootMargin) {\n  var marginString = opt_rootMargin || '0px';\n  var margins = marginString.split(/\\s+/).map(function(margin) {\n    var parts = /^(-?\\d*\\.?\\d+)(px|%)$/.exec(margin);\n    if (!parts) {\n      throw new Error('rootMargin must be specified in pixels or percent');\n    }\n    return {value: parseFloat(parts[1]), unit: parts[2]};\n  });\n\n  // Handles shorthand.\n  margins[1] = margins[1] || margins[0];\n  margins[2] = margins[2] || margins[0];\n  margins[3] = margins[3] || margins[1];\n\n  return margins;\n};\n\n\n/**\n * Starts polling for intersection changes if the polling is not already\n * happening, and if the page's visibility state is visible.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._monitorIntersections = function(doc) {\n  var win = doc.defaultView;\n  if (!win) {\n    // Already destroyed.\n    return;\n  }\n  if (this._monitoringDocuments.indexOf(doc) != -1) {\n    // Already monitoring.\n    return;\n  }\n\n  // Private state for monitoring.\n  var callback = this._checkForIntersections;\n  var monitoringInterval = null;\n  var domObserver = null;\n\n  // If a poll interval is set, use polling instead of listening to\n  // resize and scroll events or DOM mutations.\n  if (this.POLL_INTERVAL) {\n    monitoringInterval = win.setInterval(callback, this.POLL_INTERVAL);\n  } else {\n    addEvent(win, 'resize', callback, true);\n    addEvent(doc, 'scroll', callback, true);\n    if (this.USE_MUTATION_OBSERVER && 'MutationObserver' in win) {\n      domObserver = new win.MutationObserver(callback);\n      domObserver.observe(doc, {\n        attributes: true,\n        childList: true,\n        characterData: true,\n        subtree: true\n      });\n    }\n  }\n\n  this._monitoringDocuments.push(doc);\n  this._monitoringUnsubscribes.push(function() {\n    // Get the window object again. When a friendly iframe is destroyed, it\n    // will be null.\n    var win = doc.defaultView;\n\n    if (win) {\n      if (monitoringInterval) {\n        win.clearInterval(monitoringInterval);\n      }\n      removeEvent(win, 'resize', callback, true);\n    }\n\n    removeEvent(doc, 'scroll', callback, true);\n    if (domObserver) {\n      domObserver.disconnect();\n    }\n  });\n\n  // Also monitor the parent.\n  if (doc != (this.root && this.root.ownerDocument || document)) {\n    var frame = getFrameElement(doc);\n    if (frame) {\n      this._monitorIntersections(frame.ownerDocument);\n    }\n  }\n};\n\n\n/**\n * Stops polling for intersection changes.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._unmonitorIntersections = function(doc) {\n  var index = this._monitoringDocuments.indexOf(doc);\n  if (index == -1) {\n    return;\n  }\n\n  var rootDoc = (this.root && this.root.ownerDocument || document);\n\n  // Check if any dependent targets are still remaining.\n  var hasDependentTargets =\n      this._observationTargets.some(function(item) {\n        var itemDoc = item.element.ownerDocument;\n        // Target is in this context.\n        if (itemDoc == doc) {\n          return true;\n        }\n        // Target is nested in this context.\n        while (itemDoc && itemDoc != rootDoc) {\n          var frame = getFrameElement(itemDoc);\n          itemDoc = frame && frame.ownerDocument;\n          if (itemDoc == doc) {\n            return true;\n          }\n        }\n        return false;\n      });\n  if (hasDependentTargets) {\n    return;\n  }\n\n  // Unsubscribe.\n  var unsubscribe = this._monitoringUnsubscribes[index];\n  this._monitoringDocuments.splice(index, 1);\n  this._monitoringUnsubscribes.splice(index, 1);\n  unsubscribe();\n\n  // Also unmonitor the parent.\n  if (doc != rootDoc) {\n    var frame = getFrameElement(doc);\n    if (frame) {\n      this._unmonitorIntersections(frame.ownerDocument);\n    }\n  }\n};\n\n\n/**\n * Stops polling for intersection changes.\n * @param {!Document} doc\n * @private\n */\nIntersectionObserver.prototype._unmonitorAllIntersections = function() {\n  var unsubscribes = this._monitoringUnsubscribes.slice(0);\n  this._monitoringDocuments.length = 0;\n  this._monitoringUnsubscribes.length = 0;\n  for (var i = 0; i < unsubscribes.length; i++) {\n    unsubscribes[i]();\n  }\n};\n\n\n/**\n * Scans each observation target for intersection changes and adds them\n * to the internal entries queue. If new entries are found, it\n * schedules the callback to be invoked.\n * @private\n */\nIntersectionObserver.prototype._checkForIntersections = function() {\n  if (!this.root && crossOriginUpdater && !crossOriginRect) {\n    // Cross origin monitoring, but no initial data available yet.\n    return;\n  }\n\n  var rootIsInDom = this._rootIsInDom();\n  var rootRect = rootIsInDom ? this._getRootRect() : getEmptyRect();\n\n  this._observationTargets.forEach(function(item) {\n    var target = item.element;\n    var targetRect = getBoundingClientRect(target);\n    var rootContainsTarget = this._rootContainsTarget(target);\n    var oldEntry = item.entry;\n    var intersectionRect = rootIsInDom && rootContainsTarget &&\n        this._computeTargetAndRootIntersection(target, targetRect, rootRect);\n\n    var newEntry = item.entry = new IntersectionObserverEntry({\n      time: now(),\n      target: target,\n      boundingClientRect: targetRect,\n      rootBounds: crossOriginUpdater && !this.root ? null : rootRect,\n      intersectionRect: intersectionRect\n    });\n\n    if (!oldEntry) {\n      this._queuedEntries.push(newEntry);\n    } else if (rootIsInDom && rootContainsTarget) {\n      // If the new entry intersection ratio has crossed any of the\n      // thresholds, add a new entry.\n      if (this._hasCrossedThreshold(oldEntry, newEntry)) {\n        this._queuedEntries.push(newEntry);\n      }\n    } else {\n      // If the root is not in the DOM or target is not contained within\n      // root but the previous entry for this target had an intersection,\n      // add a new record indicating removal.\n      if (oldEntry && oldEntry.isIntersecting) {\n        this._queuedEntries.push(newEntry);\n      }\n    }\n  }, this);\n\n  if (this._queuedEntries.length) {\n    this._callback(this.takeRecords(), this);\n  }\n};\n\n\n/**\n * Accepts a target and root rect computes the intersection between then\n * following the algorithm in the spec.\n * TODO(philipwalton): at this time clip-path is not considered.\n * https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo\n * @param {Element} target The target DOM element\n * @param {Object} targetRect The bounding rect of the target.\n * @param {Object} rootRect The bounding rect of the root after being\n *     expanded by the rootMargin value.\n * @return {?Object} The final intersection rect object or undefined if no\n *     intersection is found.\n * @private\n */\nIntersectionObserver.prototype._computeTargetAndRootIntersection =\n    function(target, targetRect, rootRect) {\n  // If the element isn't displayed, an intersection can't happen.\n  if (window.getComputedStyle(target).display == 'none') return;\n\n  var intersectionRect = targetRect;\n  var parent = getParentNode(target);\n  var atRoot = false;\n\n  while (!atRoot && parent) {\n    var parentRect = null;\n    var parentComputedStyle = parent.nodeType == 1 ?\n        window.getComputedStyle(parent) : {};\n\n    // If the parent isn't displayed, an intersection can't happen.\n    if (parentComputedStyle.display == 'none') return null;\n\n    if (parent == this.root || parent.nodeType == /* DOCUMENT */ 9) {\n      atRoot = true;\n      if (parent == this.root || parent == document) {\n        if (crossOriginUpdater && !this.root) {\n          if (!crossOriginRect ||\n              crossOriginRect.width == 0 && crossOriginRect.height == 0) {\n            // A 0-size cross-origin intersection means no-intersection.\n            parent = null;\n            parentRect = null;\n            intersectionRect = null;\n          } else {\n            parentRect = crossOriginRect;\n          }\n        } else {\n          parentRect = rootRect;\n        }\n      } else {\n        // Check if there's a frame that can be navigated to.\n        var frame = getParentNode(parent);\n        var frameRect = frame && getBoundingClientRect(frame);\n        var frameIntersect =\n            frame &&\n            this._computeTargetAndRootIntersection(frame, frameRect, rootRect);\n        if (frameRect && frameIntersect) {\n          parent = frame;\n          parentRect = convertFromParentRect(frameRect, frameIntersect);\n        } else {\n          parent = null;\n          intersectionRect = null;\n        }\n      }\n    } else {\n      // If the element has a non-visible overflow, and it's not the <body>\n      // or <html> element, update the intersection rect.\n      // Note: <body> and <html> cannot be clipped to a rect that's not also\n      // the document rect, so no need to compute a new intersection.\n      var doc = parent.ownerDocument;\n      if (parent != doc.body &&\n          parent != doc.documentElement &&\n          parentComputedStyle.overflow != 'visible') {\n        parentRect = getBoundingClientRect(parent);\n      }\n    }\n\n    // If either of the above conditionals set a new parentRect,\n    // calculate new intersection data.\n    if (parentRect) {\n      intersectionRect = computeRectIntersection(parentRect, intersectionRect);\n    }\n    if (!intersectionRect) break;\n    parent = parent && getParentNode(parent);\n  }\n  return intersectionRect;\n};\n\n\n/**\n * Returns the root rect after being expanded by the rootMargin value.\n * @return {ClientRect} The expanded root rect.\n * @private\n */\nIntersectionObserver.prototype._getRootRect = function() {\n  var rootRect;\n  if (this.root) {\n    rootRect = getBoundingClientRect(this.root);\n  } else {\n    // Use <html>/<body> instead of window since scroll bars affect size.\n    var html = document.documentElement;\n    var body = document.body;\n    rootRect = {\n      top: 0,\n      left: 0,\n      right: html.clientWidth || body.clientWidth,\n      width: html.clientWidth || body.clientWidth,\n      bottom: html.clientHeight || body.clientHeight,\n      height: html.clientHeight || body.clientHeight\n    };\n  }\n  return this._expandRectByRootMargin(rootRect);\n};\n\n\n/**\n * Accepts a rect and expands it by the rootMargin value.\n * @param {DOMRect|ClientRect} rect The rect object to expand.\n * @return {ClientRect} The expanded rect.\n * @private\n */\nIntersectionObserver.prototype._expandRectByRootMargin = function(rect) {\n  var margins = this._rootMarginValues.map(function(margin, i) {\n    return margin.unit == 'px' ? margin.value :\n        margin.value * (i % 2 ? rect.width : rect.height) / 100;\n  });\n  var newRect = {\n    top: rect.top - margins[0],\n    right: rect.right + margins[1],\n    bottom: rect.bottom + margins[2],\n    left: rect.left - margins[3]\n  };\n  newRect.width = newRect.right - newRect.left;\n  newRect.height = newRect.bottom - newRect.top;\n\n  return newRect;\n};\n\n\n/**\n * Accepts an old and new entry and returns true if at least one of the\n * threshold values has been crossed.\n * @param {?IntersectionObserverEntry} oldEntry The previous entry for a\n *    particular target element or null if no previous entry exists.\n * @param {IntersectionObserverEntry} newEntry The current entry for a\n *    particular target element.\n * @return {boolean} Returns true if a any threshold has been crossed.\n * @private\n */\nIntersectionObserver.prototype._hasCrossedThreshold =\n    function(oldEntry, newEntry) {\n\n  // To make comparing easier, an entry that has a ratio of 0\n  // but does not actually intersect is given a value of -1\n  var oldRatio = oldEntry && oldEntry.isIntersecting ?\n      oldEntry.intersectionRatio || 0 : -1;\n  var newRatio = newEntry.isIntersecting ?\n      newEntry.intersectionRatio || 0 : -1;\n\n  // Ignore unchanged ratios\n  if (oldRatio === newRatio) return;\n\n  for (var i = 0; i < this.thresholds.length; i++) {\n    var threshold = this.thresholds[i];\n\n    // Return true if an entry matches a threshold or if the new ratio\n    // and the old ratio are on the opposite sides of a threshold.\n    if (threshold == oldRatio || threshold == newRatio ||\n        threshold < oldRatio !== threshold < newRatio) {\n      return true;\n    }\n  }\n};\n\n\n/**\n * Returns whether or not the root element is an element and is in the DOM.\n * @return {boolean} True if the root element is an element and is in the DOM.\n * @private\n */\nIntersectionObserver.prototype._rootIsInDom = function() {\n  return !this.root || containsDeep(document, this.root);\n};\n\n\n/**\n * Returns whether or not the target element is a child of root.\n * @param {Element} target The target element to check.\n * @return {boolean} True if the target element is a child of root.\n * @private\n */\nIntersectionObserver.prototype._rootContainsTarget = function(target) {\n  return containsDeep(this.root || document, target) &&\n    (!this.root || this.root.ownerDocument == target.ownerDocument);\n};\n\n\n/**\n * Adds the instance to the global IntersectionObserver registry if it isn't\n * already present.\n * @private\n */\nIntersectionObserver.prototype._registerInstance = function() {\n  if (registry.indexOf(this) < 0) {\n    registry.push(this);\n  }\n};\n\n\n/**\n * Removes the instance from the global IntersectionObserver registry.\n * @private\n */\nIntersectionObserver.prototype._unregisterInstance = function() {\n  var index = registry.indexOf(this);\n  if (index != -1) registry.splice(index, 1);\n};\n\n\n/**\n * Returns the result of the performance.now() method or null in browsers\n * that don't support the API.\n * @return {number} The elapsed time since the page was requested.\n */\nfunction now() {\n  return window.performance && performance.now && performance.now();\n}\n\n\n/**\n * Throttles a function and delays its execution, so it's only called at most\n * once within a given time period.\n * @param {Function} fn The function to throttle.\n * @param {number} timeout The amount of time that must pass before the\n *     function can be called again.\n * @return {Function} The throttled function.\n */\nfunction throttle(fn, timeout) {\n  var timer = null;\n  return function () {\n    if (!timer) {\n      timer = setTimeout(function() {\n        fn();\n        timer = null;\n      }, timeout);\n    }\n  };\n}\n\n\n/**\n * Adds an event handler to a DOM node ensuring cross-browser compatibility.\n * @param {Node} node The DOM node to add the event handler to.\n * @param {string} event The event name.\n * @param {Function} fn The event handler to add.\n * @param {boolean} opt_useCapture Optionally adds the even to the capture\n *     phase. Note: this only works in modern browsers.\n */\nfunction addEvent(node, event, fn, opt_useCapture) {\n  if (typeof node.addEventListener == 'function') {\n    node.addEventListener(event, fn, opt_useCapture || false);\n  }\n  else if (typeof node.attachEvent == 'function') {\n    node.attachEvent('on' + event, fn);\n  }\n}\n\n\n/**\n * Removes a previously added event handler from a DOM node.\n * @param {Node} node The DOM node to remove the event handler from.\n * @param {string} event The event name.\n * @param {Function} fn The event handler to remove.\n * @param {boolean} opt_useCapture If the event handler was added with this\n *     flag set to true, it should be set to true here in order to remove it.\n */\nfunction removeEvent(node, event, fn, opt_useCapture) {\n  if (typeof node.removeEventListener == 'function') {\n    node.removeEventListener(event, fn, opt_useCapture || false);\n  }\n  else if (typeof node.detatchEvent == 'function') {\n    node.detatchEvent('on' + event, fn);\n  }\n}\n\n\n/**\n * Returns the intersection between two rect objects.\n * @param {Object} rect1 The first rect.\n * @param {Object} rect2 The second rect.\n * @return {?Object|?ClientRect} The intersection rect or undefined if no\n *     intersection is found.\n */\nfunction computeRectIntersection(rect1, rect2) {\n  var top = Math.max(rect1.top, rect2.top);\n  var bottom = Math.min(rect1.bottom, rect2.bottom);\n  var left = Math.max(rect1.left, rect2.left);\n  var right = Math.min(rect1.right, rect2.right);\n  var width = right - left;\n  var height = bottom - top;\n\n  return (width >= 0 && height >= 0) && {\n    top: top,\n    bottom: bottom,\n    left: left,\n    right: right,\n    width: width,\n    height: height\n  } || null;\n}\n\n\n/**\n * Shims the native getBoundingClientRect for compatibility with older IE.\n * @param {Element} el The element whose bounding rect to get.\n * @return {DOMRect|ClientRect} The (possibly shimmed) rect of the element.\n */\nfunction getBoundingClientRect(el) {\n  var rect;\n\n  try {\n    rect = el.getBoundingClientRect();\n  } catch (err) {\n    // Ignore Windows 7 IE11 \"Unspecified error\"\n    // https://github.com/w3c/IntersectionObserver/pull/205\n  }\n\n  if (!rect) return getEmptyRect();\n\n  // Older IE\n  if (!(rect.width && rect.height)) {\n    rect = {\n      top: rect.top,\n      right: rect.right,\n      bottom: rect.bottom,\n      left: rect.left,\n      width: rect.right - rect.left,\n      height: rect.bottom - rect.top\n    };\n  }\n  return rect;\n}\n\n\n/**\n * Returns an empty rect object. An empty rect is returned when an element\n * is not in the DOM.\n * @return {ClientRect} The empty rect.\n */\nfunction getEmptyRect() {\n  return {\n    top: 0,\n    bottom: 0,\n    left: 0,\n    right: 0,\n    width: 0,\n    height: 0\n  };\n}\n\n\n/**\n * Ensure that the result has all of the necessary fields of the DOMRect.\n * Specifically this ensures that `x` and `y` fields are set.\n *\n * @param {?DOMRect|?ClientRect} rect\n * @return {?DOMRect}\n */\nfunction ensureDOMRect(rect) {\n  // A `DOMRect` object has `x` and `y` fields.\n  if (!rect || 'x' in rect) {\n    return rect;\n  }\n  // A IE's `ClientRect` type does not have `x` and `y`. The same is the case\n  // for internally calculated Rect objects. For the purposes of\n  // `IntersectionObserver`, it's sufficient to simply mirror `left` and `top`\n  // for these fields.\n  return {\n    top: rect.top,\n    y: rect.top,\n    bottom: rect.bottom,\n    left: rect.left,\n    x: rect.left,\n    right: rect.right,\n    width: rect.width,\n    height: rect.height\n  };\n}\n\n\n/**\n * Inverts the intersection and bounding rect from the parent (frame) BCR to\n * the local BCR space.\n * @param {DOMRect|ClientRect} parentBoundingRect The parent's bound client rect.\n * @param {DOMRect|ClientRect} parentIntersectionRect The parent's own intersection rect.\n * @return {ClientRect} The local root bounding rect for the parent's children.\n */\nfunction convertFromParentRect(parentBoundingRect, parentIntersectionRect) {\n  var top = parentIntersectionRect.top - parentBoundingRect.top;\n  var left = parentIntersectionRect.left - parentBoundingRect.left;\n  return {\n    top: top,\n    left: left,\n    height: parentIntersectionRect.height,\n    width: parentIntersectionRect.width,\n    bottom: top + parentIntersectionRect.height,\n    right: left + parentIntersectionRect.width\n  };\n}\n\n\n/**\n * Checks to see if a parent element contains a child element (including inside\n * shadow DOM).\n * @param {Node} parent The parent element.\n * @param {Node} child The child element.\n * @return {boolean} True if the parent node contains the child node.\n */\nfunction containsDeep(parent, child) {\n  var node = child;\n  while (node) {\n    if (node == parent) return true;\n\n    node = getParentNode(node);\n  }\n  return false;\n}\n\n\n/**\n * Gets the parent node of an element or its host element if the parent node\n * is a shadow root.\n * @param {Node} node The node whose parent to get.\n * @return {Node|null} The parent node or null if no parent exists.\n */\nfunction getParentNode(node) {\n  var parent = node.parentNode;\n\n  if (node.nodeType == /* DOCUMENT */ 9 && node != document) {\n    // If this node is a document node, look for the embedding frame.\n    return getFrameElement(node);\n  }\n\n  if (parent && parent.nodeType == 11 && parent.host) {\n    // If the parent is a shadow root, return the host element.\n    return parent.host;\n  }\n\n  if (parent && parent.assignedSlot) {\n    // If the parent is distributed in a <slot>, return the parent of a slot.\n    return parent.assignedSlot.parentNode;\n  }\n\n  return parent;\n}\n\n\n// Exposes the constructors globally.\nwindow.IntersectionObserver = IntersectionObserver;\nwindow.IntersectionObserverEntry = IntersectionObserverEntry;\n\n}());\n","export default \"<div class=\\\"horizontal-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    actorType=\\\"lazy\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\\n<div class=\\\"vertical-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    actorType=\\\"lazy\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\";","export default \".horizontal-list {\\n  display: flex;\\n  flex-wrap: nowrap;\\n  overflow-x: auto;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL29uY2UtYWN0b3IuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxhQUFBO0VBQ0EsaUJBQUE7RUFDQSxnQkFBQTtBQUNGIiwiZmlsZSI6Im9uY2UtYWN0b3IuY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuaG9yaXpvbnRhbC1saXN0IHtcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC13cmFwOiBub3dyYXA7XG4gIG92ZXJmbG93LXg6IGF1dG87XG59XG4iXX0= */\";","import { Actor } from \"projects/packages/src/public-api\";\n\nexport enum SampleActorType {\n  BASE = \"base\",\n  ONCE = \"once\",\n  LAZY = \"lazy\",\n}\n\nexport enum SampleActorEventType {\n  ATTACH = \"ATTACH\",\n  DETACH = \"DETACH\",\n}\n\nexport interface SampleActorEvent {\n  type: SampleActorEventType;\n  actor: Actor;\n}\n","export default \":host {\\n  display: block;\\n  margin: 10px;\\n  padding: 20px;\\n  color: #333333;\\n  border-radius: 4px;\\n  box-sizing: border-box;\\n  background-color: #ffffff;\\n  transition: color 300ms, background-color 300ms;\\n}\\n:host.is-appeared {\\n  color: #ffffff;\\n  background-color: #333333;\\n}\\n:host .panel-count {\\n  display: flex;\\n  text-align: center;\\n}\\n:host .panel-count .spacer {\\n  flex: 1;\\n  min-width: 20px;\\n}\\n:host .panel-count .label {\\n  display: block;\\n  font-size: 13px;\\n}\\n:host .panel-count .count {\\n  display: block;\\n  padding-top: 5px;\\n  font-size: 24px;\\n  font-weight: bold;\\n}\\n:host .panel-item {\\n  padding-top: 5px;\\n  text-align: center;\\n  font-size: 13px;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uLy4uL3NhbXBsZS1hY3Rvci5jb21wb25lbnQuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLGNBQUE7RUFDQSxZQUFBO0VBQ0EsYUFBQTtFQUNBLGNBQUE7RUFDQSxrQkFBQTtFQUNBLHNCQUFBO0VBQ0EseUJBQUE7RUFDQSwrQ0FBQTtBQUNGO0FBQUU7RUFDRSxjQUFBO0VBQ0EseUJBQUE7QUFFSjtBQUNFO0VBQ0UsYUFBQTtFQUNBLGtCQUFBO0FBQ0o7QUFBSTtFQUNFLE9BQUE7RUFDQSxlQUFBO0FBRU47QUFBSTtFQUNFLGNBQUE7RUFDQSxlQUFBO0FBRU47QUFBSTtFQUNFLGNBQUE7RUFDQSxnQkFBQTtFQUNBLGVBQUE7RUFDQSxpQkFBQTtBQUVOO0FBRUU7RUFDRSxnQkFBQTtFQUNBLGtCQUFBO0VBQ0EsZUFBQTtBQUFKIiwiZmlsZSI6InNhbXBsZS1hY3Rvci5jb21wb25lbnQuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIjpob3N0IHtcbiAgZGlzcGxheTogYmxvY2s7XG4gIG1hcmdpbjogMTBweDtcbiAgcGFkZGluZzogMjBweDtcbiAgY29sb3I6ICMzMzMzMzM7XG4gIGJvcmRlci1yYWRpdXM6IDRweDtcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcbiAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjtcbiAgdHJhbnNpdGlvbjogY29sb3IgMzAwbXMsIGJhY2tncm91bmQtY29sb3IgMzAwbXM7XG4gICYuaXMtYXBwZWFyZWQge1xuICAgIGNvbG9yOiAjZmZmZmZmO1xuICAgIGJhY2tncm91bmQtY29sb3I6ICMzMzMzMzM7XG4gIH1cblxuICAucGFuZWwtY291bnQge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIC5zcGFjZXIge1xuICAgICAgZmxleDogMTtcbiAgICAgIG1pbi13aWR0aDogMjBweDtcbiAgICB9XG4gICAgLmxhYmVsIHtcbiAgICAgIGRpc3BsYXk6IGJsb2NrO1xuICAgICAgZm9udC1zaXplOiAxM3B4O1xuICAgIH1cbiAgICAuY291bnQge1xuICAgICAgZGlzcGxheTogYmxvY2s7XG4gICAgICBwYWRkaW5nLXRvcDogNXB4O1xuICAgICAgZm9udC1zaXplOiAyNHB4O1xuICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG4gICAgfVxuICB9XG5cbiAgLnBhbmVsLWl0ZW0ge1xuICAgIHBhZGRpbmctdG9wOiA1cHg7XG4gICAgdGV4dC1hbGlnbjogY2VudGVyO1xuICAgIGZvbnQtc2l6ZTogMTNweDtcbiAgfVxufVxuIl19 */\";","import { ActorElement, AppearEvent, IActor, IStage } from '../common/types';\nimport { Subject } from 'rxjs';\n\n/**\n * Stage 에 등록될 Actor.\n * 스테이지에 진입, 이탈 시 계속 알려주는 기본형.\n * @class BaseActor\n * @implements {IActor}\n */\nexport class BaseActor implements IActor {\n  /**\n   * @param element 옵저버에 등록되어야 하는 native element\n   */\n  constructor(element: ActorElement) {\n    this.element = element;\n  }\n\n  /**\n   * 옵저버에 등록될 native element\n   */\n  element: ActorElement;\n\n  /**\n   * 이벤트 Observable\n   * @see https://rxjs-dev.firebaseapp.com/guide/subject\n   */\n  events: Subject<AppearEvent> = new Subject<AppearEvent>();\n\n  /**\n   * 해당 인스턴스가 등록된 스테이지\n   */\n  stage: IStage<BaseActor>;\n\n  /**\n   * 현재 진입 여부 상태\n   */\n  isAppear: boolean = null;\n\n  /**\n   * 해당 인스턴스를 관찰하는 스테이지를 연결\n   * @param stage 스테이지\n   */\n  bind(stage: IStage<BaseActor>) {\n    this.stage = stage;\n  }\n\n  /**\n   * 진입, 이탈 등 이벤트 알림\n   * @param type 이벤트 타입\n   * @param [entry] 상태 변경시 관찰된 상태\n   */\n  dispatch(type: string, entry?: IntersectionObserverEntry) {\n    this.events.next(\n      new AppearEvent(type, {\n        actor: this,\n        entry,\n      })\n    );\n  }\n\n  /**\n   * 스테이지 진입\n   * @param [entry] 스테이지 진입시 관찰 상태\n   */\n  appear(entry?: IntersectionObserverEntry): void {\n    if (this.isAppear === true) return;\n    this.isAppear = true;\n    this.dispatch(AppearEvent.APPEAR, entry);\n  }\n\n  /**\n   * 스테이지 이탈\n   * @param [entry] 스테이지 이탈시 관찰 상태\n   */\n  disappear(entry?: IntersectionObserverEntry): void {\n    if (this.isAppear === false) return;\n    this.isAppear = false;\n    this.dispatch(AppearEvent.DISAPPEAR, entry);\n  }\n\n  /**\n   * 파기\n   */\n  dispose() {\n    if (this.stage) {\n      this.stage.unobserve(this);\n    }\n  }\n}\n","export default \"<div class=\\\"horizontal-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    actorType=\\\"once\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\\n<div class=\\\"vertical-list\\\">\\n  <sample-actor\\n    *ngFor=\\\"let item of actorMakeList\\\"\\n    actorType=\\\"once\\\"\\n    (sampleEvent)=\\\"onSampleAppearEvent($event)\\\"\\n  >\\n  </sample-actor>\\n</div>\\n\";","import \"intersection-observer\";\n\nexport * from \"./stage/appear-stage\";\nexport * from \"./actor/base-actor\";\nexport * from \"./actor/once-actor\";\nexport * from \"./actor/lazy-actor\";\nexport * from \"./common/types\";\n","import { NgModule } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { SampleActorComponent } from \"~/dev/app/modules/example/common/sample-actor/sample-actor.component\";\n\n@NgModule({\n  imports: [CommonModule],\n  exports: [SampleActorComponent],\n  declarations: [SampleActorComponent],\n})\nexport class ExampleCommonModule {}\n","import { BaseActor } from './base-actor';\nimport { AppearEvent, ILazyActor } from '../common/types';\n\n/**\n * Stage 에 등록될 Actor.\n * 스테이지에 진입을 한번만 감지하되, 진입 후 너무 빠르게 이탈시에는 감지 처리를 하지 않는 느린 감지형.\n * (사용 예: 촘촘한 상품 목록과 같이 빠르게 스크롤 하여 지나칠 수 있는 곳)\n * @class LazyActor\n * @extends {BaseActor}\n */\nexport class LazyActor extends BaseActor implements ILazyActor {\n  private appearTimer: any = null;\n  private checkoutDelay: number = 1000;\n  private appearDelay: number = 150;\n\n  /**\n   * 느린 감지를 시작하기 전 대기 시간.\n   * 지정된 시간 전에 감지된 진입은 느린 감지를 하지 않고 바로 진입을 알림.\n   * @param [delay=1000]\n   */\n  setCheckoutDelay(delay: number = 1000) {\n    this.checkoutDelay = delay;\n  }\n\n  /**\n   * 지정된 시간 사이에 진입 후 진출을 하는 경우 진입 알림을 하지 않는 대기 시간.\n   * @param [delay=150]\n   */\n  setAppearDelay(delay: number = 150) {\n    this.appearDelay = delay;\n  }\n\n  /**\n   * 진입 대기 타이머 파기\n   */\n  private clearAppearTimer() {\n    if (this.appearTimer) {\n      clearTimeout(this.appearTimer);\n      this.appearTimer = null;\n    }\n  }\n\n  /**\n   * 스테이지 진입. 진입 후 일정시간 (appearDelay) 전에 이탈하는 경우는 진입으로 취급하지 않음.\n   * @override\n   * @param [entry]\n   */\n  appear(entry: IntersectionObserverEntry) {\n    this.clearAppearTimer();\n    if (this.isAppear === true) return;\n    if (this.checkoutDelay <= entry.time) {\n      this.appearTimer = setTimeout(() => {\n        this.doAppear(entry);\n      }, this.appearDelay);\n    } else {\n      this.doAppear(entry);\n    }\n  }\n\n  /**\n   * 실제 진입 처리.\n   * @private\n   * @param entry\n   */\n  private doAppear(entry: IntersectionObserverEntry) {\n    this.isAppear = true;\n    this.dispatch(AppearEvent.APPEAR, entry);\n    if (this.stage) {\n      this.stage.unobserve(this);\n    }\n  }\n\n  /**\n   * 스테이지 이탈.\n   * @override\n   * @param entry\n   */\n  disappear(entry: IntersectionObserverEntry) {\n    this.clearAppearTimer();\n    if (!this.isAppear) return;\n    this.isAppear = false;\n    this.dispatch(AppearEvent.DISAPPEAR, entry);\n  }\n}\n","import { IStage, StageOption, Actor, ActorElement } from \"../common/types\";\n\n/**\n * 화면(지정된 root 영역)에 진입 여부를 판단하고 알리기 위한 클래스.\n * 등록된 Actor(s)를 IntersectionObserver 를 통해 관찰하고 관찰된 상태에 따라 Actor 에게 알림.\n * @template T Actor\n */\nexport class AppearStage<T extends Actor = Actor> implements IStage<T> {\n  /**\n   * Actor 맵\n   */\n  protected actorMap: Map<ActorElement, T>;\n\n  /**\n   * IntersectionObserver\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n   */\n  protected observer: IntersectionObserver;\n\n  /**\n   * 초기화\n   * @param [option] 초기 옵션. 인터섹션 옵저버는 생성시에만 옵션 지정이 가능\n   */\n  init(option: StageOption = {}): void {\n    if (!this.observer) {\n      this.actorMap = new Map<ActorElement, T>();\n      this.observer = new IntersectionObserver(\n        this.onObserveEntries.bind(this),\n        option\n      );\n    }\n  }\n\n  /**\n   * 전달된 actor 를 옵저버에 등록합니다.\n   * @param actor 등록할 Actor\n   */\n  observe(actor: T): void {\n    const { element } = actor;\n    if (this.actorMap && !this.actorMap.has(element)) {\n      actor.bind(this);\n      this.actorMap.set(element, actor);\n      this.intersectionObserver.observe(element);\n    }\n  }\n\n  /**\n   * 전달된 actor 를 옵저버에서 제외합니다.\n   * @param actor 제외할 Actor\n   */\n  unobserve(actor: T): void {\n    const { element } = actor;\n    if (this.actorMap && this.actorMap.has(element)) {\n      this.actorMap.delete(element);\n      this.intersectionObserver.unobserve(element);\n    }\n  }\n\n  /**\n   * 옵저버에 등록(관찰) 중 인 Actor 의 수\n   */\n  get actorSize() {\n    return this.actorMap ? this.actorMap.size : 0;\n  }\n\n  /**\n   * 등록 되어있는 Actor 를 반환 합니다.\n   * @returns T[]\n   */\n  getActors(): T[] {\n    return Array.from(this.actorMap ? this.actorMap.values() : []);\n  }\n\n  /**\n   * 생성된 intersection observer 인스턴스\n   */\n  get intersectionObserver(): IntersectionObserver {\n    if (!this.observer) throw new Error(\"uninitialize\");\n    return this.observer;\n  }\n\n  /**\n   * 옵저버의 콜백 핸들러\n   * @param entries 옵저버의 콜백으로 전달받는 엔트리 값\n   */\n  protected onObserveEntries(entries: IntersectionObserverEntry[]) {\n    entries.forEach((entry: IntersectionObserverEntry) => {\n      if (!this.actorMap) return;\n      const { isIntersecting, target } = entry;\n      const actor = this.actorMap.get(target);\n      if (actor) {\n        if (isIntersecting) {\n          actor.appear(entry);\n        } else {\n          actor.disappear(entry);\n        }\n      }\n    });\n  }\n\n  /**\n   * 파기\n   */\n  dispose(): void {\n    if (this.observer) {\n      this.observer.disconnect();\n      this.observer = null;\n    }\n    if (this.actorMap) {\n      this.actorMap.clear();\n      this.actorMap = null;\n    }\n  }\n}\n","export default \"<div class=\\\"panel-count\\\">\\n  <div class=\\\"aside\\\">\\n    <span class=\\\"label\\\">appearCount</span>\\n    <span class=\\\"count\\\">{{ appearCount }}</span>\\n  </div>\\n  <div class=\\\"spacer\\\"></div>\\n  <div class=\\\"bside\\\">\\n    <span class=\\\"label\\\">disappearCount</span>\\n    <span class=\\\"count\\\">{{ disappearCount }}</span>\\n  </div>\\n</div>\\n<div class=\\\"panel-item\\\">\\n  {{ item | json }}\\n</div>\\n\";"]}